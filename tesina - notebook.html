<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>0f481120ec9e4466aff5975ebc0ac21f</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell code" data-execution_count="1" id="QCjRcPc8WxbN">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizaci√≥n</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">&#39;figure.figsize&#39;</span>: (<span class="dv">12</span>, <span class="dv">7</span>)}) <span class="co">#para estandarizar el tama√±o de todos los gr√°ficos</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sns.set_theme() <span class="co"># aplica el tema est√°ndar visual de los gr√°ficos</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#para que al exportar el c√≥digo los gr√°ficos queden bien presentados</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine Learning</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># M√©tricas de evaluaci√≥n de mmodelo</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_squared_error, r2_score</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># EVT --- Distribuci√≥n Generalizada de Pareto para la cola de la distribuci√≥n</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genpareto, lognorm</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> bisect <span class="co">#m√©todo de bisecci√≥n para encontrar ra√≠ces de ecuaciones num√©ricamente (en este caso, para encontrar el VaR)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilidad de ejes</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter <span class="co">#funci√≥n personalizada para formatear los n√∫meros de los ejes en los gr√°ficos</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducibilidad simple</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_seed(seed<span class="op">=</span><span class="dv">123</span>):</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    random.seed(seed)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="2Bjl7JqjtRtx" data-outputId="ede41acd-83d2-47a7-d399-a7cbbef8e31f">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install category<span class="op">-</span>encoders</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> category_encoders <span class="im">import</span> TargetEncoder</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Collecting category-encoders
  Downloading category_encoders-2.9.0-py3-none-any.whl.metadata (7.9 kB)
Requirement already satisfied: numpy&gt;=1.14.0 in /usr/local/lib/python3.12/dist-packages (from category-encoders) (2.0.2)
Requirement already satisfied: pandas&gt;=1.0.5 in /usr/local/lib/python3.12/dist-packages (from category-encoders) (2.2.2)
Requirement already satisfied: patsy&gt;=0.5.1 in /usr/local/lib/python3.12/dist-packages (from category-encoders) (1.0.2)
Requirement already satisfied: scikit-learn&gt;=1.6.0 in /usr/local/lib/python3.12/dist-packages (from category-encoders) (1.6.1)
Requirement already satisfied: scipy&gt;=1.0.0 in /usr/local/lib/python3.12/dist-packages (from category-encoders) (1.16.3)
Requirement already satisfied: statsmodels&gt;=0.9.0 in /usr/local/lib/python3.12/dist-packages (from category-encoders) (0.14.5)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.12/dist-packages (from pandas&gt;=1.0.5-&gt;category-encoders) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.12/dist-packages (from pandas&gt;=1.0.5-&gt;category-encoders) (2025.2)
Requirement already satisfied: tzdata&gt;=2022.7 in /usr/local/lib/python3.12/dist-packages (from pandas&gt;=1.0.5-&gt;category-encoders) (2025.2)
Requirement already satisfied: joblib&gt;=1.2.0 in /usr/local/lib/python3.12/dist-packages (from scikit-learn&gt;=1.6.0-&gt;category-encoders) (1.5.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /usr/local/lib/python3.12/dist-packages (from scikit-learn&gt;=1.6.0-&gt;category-encoders) (3.6.0)
Requirement already satisfied: packaging&gt;=21.3 in /usr/local/lib/python3.12/dist-packages (from statsmodels&gt;=0.9.0-&gt;category-encoders) (25.0)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=1.0.5-&gt;category-encoders) (1.17.0)
Downloading category_encoders-2.9.0-py3-none-any.whl (85 kB)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 85.9/85.9 kB 1.9 MB/s eta 0:00:00
</code></pre>
</div>
</div>
<section id="-preparaci√≥n-de-los-datos" class="cell markdown"
id="qczMOVDHNei-">
<h1>üìä Preparaci√≥n de los datos</h1>
</section>
<div class="cell code" data-execution_count="3"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:256}"
id="UfMQB5y2ZAHY" data-outputId="1741081d-0b94-4488-b74a-a1beba59e58b">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/dataset_tesis.csv&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(df)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="3">

  <div id="df-8fdc9249-67df-43d9-85a0-3ff0d34348b9" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>KIDSDRIV</th>
      <th>AGE</th>
      <th>HOMEKIDS</th>
      <th>YOJ</th>
      <th>INCOME</th>
      <th>PARENT1</th>
      <th>HOME_VAL</th>
      <th>MSTATUS</th>
      <th>GENDER</th>
      <th>...</th>
      <th>TIF</th>
      <th>CAR_TYPE</th>
      <th>RED_CAR</th>
      <th>OLDCLAIM</th>
      <th>CLM_FREQ</th>
      <th>REVOKED</th>
      <th>MVR_PTS</th>
      <th>CLM_AMT</th>
      <th>CAR_AGE</th>
      <th>CLAIM_FLAG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>63581743</td>
      <td>0</td>
      <td>60.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>$67,349</td>
      <td>No</td>
      <td>$0</td>
      <td>z_No</td>
      <td>M</td>
      <td>...</td>
      <td>11</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>$4,461</td>
      <td>2</td>
      <td>No</td>
      <td>3</td>
      <td>$0</td>
      <td>18.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>132761049</td>
      <td>0</td>
      <td>43.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>$91,449</td>
      <td>No</td>
      <td>$257,252</td>
      <td>z_No</td>
      <td>M</td>
      <td>...</td>
      <td>1</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>$0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>$0</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>921317019</td>
      <td>0</td>
      <td>48.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>$52,881</td>
      <td>No</td>
      <td>$0</td>
      <td>z_No</td>
      <td>M</td>
      <td>...</td>
      <td>1</td>
      <td>Van</td>
      <td>yes</td>
      <td>$0</td>
      <td>0</td>
      <td>No</td>
      <td>2</td>
      <td>$0</td>
      <td>10.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>727598473</td>
      <td>0</td>
      <td>35.0</td>
      <td>1</td>
      <td>10.0</td>
      <td>$16,039</td>
      <td>No</td>
      <td>$124,191</td>
      <td>Yes</td>
      <td>z_F</td>
      <td>...</td>
      <td>4</td>
      <td>z_SUV</td>
      <td>no</td>
      <td>$38,690</td>
      <td>2</td>
      <td>No</td>
      <td>3</td>
      <td>$0</td>
      <td>10.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>450221861</td>
      <td>0</td>
      <td>51.0</td>
      <td>0</td>
      <td>14.0</td>
      <td>NaN</td>
      <td>No</td>
      <td>$306,251</td>
      <td>Yes</td>
      <td>M</td>
      <td>...</td>
      <td>7</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>$0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>$0</td>
      <td>6.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows √ó 25 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-8fdc9249-67df-43d9-85a0-3ff0d34348b9')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-8fdc9249-67df-43d9-85a0-3ff0d34348b9 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-8fdc9249-67df-43d9-85a0-3ff0d34348b9');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-971af9f5-a597-4baa-8338-2a7cc499b77c">
      <button class="colab-df-quickchart" onclick="quickchart('df-971af9f5-a597-4baa-8338-2a7cc499b77c')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-971af9f5-a597-4baa-8338-2a7cc499b77c button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="4"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="LGqR1bwFVx8v" data-outputId="77bad923-c509-46d9-c31c-369deaf95e1f">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<pre><code>(10302, 25)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:868}"
id="xcuZ1T7WZdX8" data-outputId="d3f1f18e-b3e1-4376-ddf2-075def58c6d9">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.isna().<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ID</th>
      <td>0</td>
    </tr>
    <tr>
      <th>KIDSDRIV</th>
      <td>0</td>
    </tr>
    <tr>
      <th>AGE</th>
      <td>7</td>
    </tr>
    <tr>
      <th>HOMEKIDS</th>
      <td>0</td>
    </tr>
    <tr>
      <th>YOJ</th>
      <td>548</td>
    </tr>
    <tr>
      <th>INCOME</th>
      <td>570</td>
    </tr>
    <tr>
      <th>PARENT1</th>
      <td>0</td>
    </tr>
    <tr>
      <th>HOME_VAL</th>
      <td>575</td>
    </tr>
    <tr>
      <th>MSTATUS</th>
      <td>0</td>
    </tr>
    <tr>
      <th>GENDER</th>
      <td>0</td>
    </tr>
    <tr>
      <th>EDUCATION</th>
      <td>0</td>
    </tr>
    <tr>
      <th>OCCUPATION</th>
      <td>665</td>
    </tr>
    <tr>
      <th>TRAVTIME</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CAR_USE</th>
      <td>0</td>
    </tr>
    <tr>
      <th>BLUEBOOK</th>
      <td>0</td>
    </tr>
    <tr>
      <th>TIF</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CAR_TYPE</th>
      <td>0</td>
    </tr>
    <tr>
      <th>RED_CAR</th>
      <td>0</td>
    </tr>
    <tr>
      <th>OLDCLAIM</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CLM_FREQ</th>
      <td>0</td>
    </tr>
    <tr>
      <th>REVOKED</th>
      <td>0</td>
    </tr>
    <tr>
      <th>MVR_PTS</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CLM_AMT</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CAR_AGE</th>
      <td>639</td>
    </tr>
    <tr>
      <th>CLAIM_FLAG</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div><br><label><b>dtype:</b> int64</label>
</div>
</div>
<div class="cell markdown" id="7QlIbKr3piyX">
<p>Columnas con NaN: INCOME, YOJ, HOME_VAL, OCCUPATION, CAR_AGE</p>
</div>
<div class="cell code" data-execution_count="6"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:531}"
id="RuNxQU_vZgx-" data-outputId="77c1c959-14d3-4568-cf06-7e5d9daeacb9">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpieza de caracteres especiales</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.applymap(<span class="kw">lambda</span> x: x.replace(<span class="st">&#39;$&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(x, <span class="bu">str</span>) <span class="cf">else</span> x)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.replace(to_replace<span class="op">=</span><span class="vs">r&#39;^z_&#39;</span>, value<span class="op">=</span><span class="st">&#39;&#39;</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.applymap(<span class="kw">lambda</span> x: x.replace(<span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(x, <span class="bu">str</span>) <span class="cf">else</span> x)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/tmp/ipython-input-3303880705.py:2: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df = df.applymap(lambda x: x.replace(&#39;$&#39;, &#39;&#39;) if isinstance(x, str) else x)
/tmp/ipython-input-3303880705.py:4: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df = df.applymap(lambda x: x.replace(&#39;,&#39;, &#39;&#39;) if isinstance(x, str) else x)
</code></pre>
</div>
<div class="output execute_result" data-execution_count="6">

  <div id="df-e459c820-e3c1-48e8-ac29-f99ecc5b7946" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>KIDSDRIV</th>
      <th>AGE</th>
      <th>HOMEKIDS</th>
      <th>YOJ</th>
      <th>INCOME</th>
      <th>PARENT1</th>
      <th>HOME_VAL</th>
      <th>MSTATUS</th>
      <th>GENDER</th>
      <th>...</th>
      <th>TIF</th>
      <th>CAR_TYPE</th>
      <th>RED_CAR</th>
      <th>OLDCLAIM</th>
      <th>CLM_FREQ</th>
      <th>REVOKED</th>
      <th>MVR_PTS</th>
      <th>CLM_AMT</th>
      <th>CAR_AGE</th>
      <th>CLAIM_FLAG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>63581743</td>
      <td>0</td>
      <td>60.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>67349</td>
      <td>No</td>
      <td>0</td>
      <td>No</td>
      <td>M</td>
      <td>...</td>
      <td>11</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>4461</td>
      <td>2</td>
      <td>No</td>
      <td>3</td>
      <td>0</td>
      <td>18.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>132761049</td>
      <td>0</td>
      <td>43.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>91449</td>
      <td>No</td>
      <td>257252</td>
      <td>No</td>
      <td>M</td>
      <td>...</td>
      <td>1</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>921317019</td>
      <td>0</td>
      <td>48.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>52881</td>
      <td>No</td>
      <td>0</td>
      <td>No</td>
      <td>M</td>
      <td>...</td>
      <td>1</td>
      <td>Van</td>
      <td>yes</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>2</td>
      <td>0</td>
      <td>10.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>727598473</td>
      <td>0</td>
      <td>35.0</td>
      <td>1</td>
      <td>10.0</td>
      <td>16039</td>
      <td>No</td>
      <td>124191</td>
      <td>Yes</td>
      <td>F</td>
      <td>...</td>
      <td>4</td>
      <td>SUV</td>
      <td>no</td>
      <td>38690</td>
      <td>2</td>
      <td>No</td>
      <td>3</td>
      <td>0</td>
      <td>10.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>450221861</td>
      <td>0</td>
      <td>51.0</td>
      <td>0</td>
      <td>14.0</td>
      <td>NaN</td>
      <td>No</td>
      <td>306251</td>
      <td>Yes</td>
      <td>M</td>
      <td>...</td>
      <td>7</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>0</td>
      <td>6.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10297</th>
      <td>67790126</td>
      <td>1</td>
      <td>45.0</td>
      <td>2</td>
      <td>9.0</td>
      <td>164669</td>
      <td>No</td>
      <td>386273</td>
      <td>Yes</td>
      <td>M</td>
      <td>...</td>
      <td>15</td>
      <td>Minivan</td>
      <td>no</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>2</td>
      <td>0</td>
      <td>17.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10298</th>
      <td>61970712</td>
      <td>0</td>
      <td>46.0</td>
      <td>0</td>
      <td>9.0</td>
      <td>107204</td>
      <td>No</td>
      <td>332591</td>
      <td>Yes</td>
      <td>M</td>
      <td>...</td>
      <td>6</td>
      <td>Panel Truck</td>
      <td>no</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10299</th>
      <td>849208064</td>
      <td>0</td>
      <td>48.0</td>
      <td>0</td>
      <td>15.0</td>
      <td>39837</td>
      <td>No</td>
      <td>170611</td>
      <td>Yes</td>
      <td>F</td>
      <td>...</td>
      <td>7</td>
      <td>SUV</td>
      <td>no</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10300</th>
      <td>627828331</td>
      <td>0</td>
      <td>50.0</td>
      <td>0</td>
      <td>7.0</td>
      <td>43445</td>
      <td>No</td>
      <td>149248</td>
      <td>Yes</td>
      <td>F</td>
      <td>...</td>
      <td>6</td>
      <td>Minivan</td>
      <td>no</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>0</td>
      <td>11.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10301</th>
      <td>680381960</td>
      <td>0</td>
      <td>52.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>53235</td>
      <td>No</td>
      <td>197017</td>
      <td>Yes</td>
      <td>F</td>
      <td>...</td>
      <td>6</td>
      <td>Minivan</td>
      <td>no</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>0</td>
      <td>9.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>10302 rows √ó 25 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-e459c820-e3c1-48e8-ac29-f99ecc5b7946')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-e459c820-e3c1-48e8-ac29-f99ecc5b7946 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-e459c820-e3c1-48e8-ac29-f99ecc5b7946');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-38b9ad7b-4f9c-4d1e-87fa-1b4047f552af">
      <button class="colab-df-quickchart" onclick="quickchart('df-38b9ad7b-4f9c-4d1e-87fa-1b4047f552af')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-38b9ad7b-4f9c-4d1e-87fa-1b4047f552af button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

  <div id="id_527914e4-225c-4c79-abf2-ff7c7ce5d468">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_527914e4-225c-4c79-abf2-ff7c7ce5d468 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df');
      }
      })();
    </script>
  </div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="7" id="Y3ap3G5kZlz4">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversi√≥n de columnas num√©ricas: si la columna es categ√≥rica, intento convertirla a float.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.columns:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df[i].dtypes <span class="op">==</span> <span class="st">&quot;object&quot;</span>:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            df[i] <span class="op">=</span> df[i].astype(<span class="bu">float</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="8"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:424}"
id="TpVY5BfEZrox" data-outputId="6b5030f9-63e1-4d5e-9e86-91f867230792">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># me creo un DF con frecuencia y severidad</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_freq_sev <span class="op">=</span> df.groupby(<span class="st">&#39;ID&#39;</span>).agg({<span class="st">&#39;CLAIM_FLAG&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;CLM_AMT&#39;</span>: <span class="st">&#39;mean&#39;</span>}) <span class="co">#agrupo todo por ID, o sea por p√≥liza</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># o sea para las p√≥lizas que tienen m√°s de un registro agrupo y uso sus valores promedios</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CLAIM FLAG: ejemplo, si un cliente tiene 3 registros y 1 siniestro ‚Üí frecuencia = 1/3 = 0.33.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CLM_AMT: monto promedio de siniestro</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df_freq_sev <span class="op">=</span> df_freq_sev.reset_index()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df_freq_sev.columns  <span class="op">=</span> [<span class="st">&#39;ID&#39;</span>, <span class="st">&#39;FREQUENCY&#39;</span>, <span class="st">&#39;SEVERITY&#39;</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df_freq_sev</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">

  <div id="df-80e49a93-149a-4984-a049-2f6782638cf3" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>FREQUENCY</th>
      <th>SEVERITY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>63175</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>246910</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>401276</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>813128</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1307371</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8748</th>
      <td>999482663</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8749</th>
      <td>999577084</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8750</th>
      <td>999640290</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8751</th>
      <td>999800537</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8752</th>
      <td>999926368</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>8753 rows √ó 3 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-80e49a93-149a-4984-a049-2f6782638cf3')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-80e49a93-149a-4984-a049-2f6782638cf3 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-80e49a93-149a-4984-a049-2f6782638cf3');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-a60e96fa-8d7e-4148-a1b8-cd73fba0f7ee">
      <button class="colab-df-quickchart" onclick="quickchart('df-a60e96fa-8d7e-4148-a1b8-cd73fba0f7ee')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-a60e96fa-8d7e-4148-a1b8-cd73fba0f7ee button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

  <div id="id_0e7b8507-89e0-4452-a50a-dfc3b29a7019">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df_freq_sev')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_0e7b8507-89e0-4452-a50a-dfc3b29a7019 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df_freq_sev');
      }
      })();
    </script>
  </div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="9"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:444}"
id="SHHFjUk_ZxzY" data-outputId="b1c1c3f1-e5f6-44f9-b619-3c9573dfdb3d">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Combino mi df agrupado por poliza con mi df inicial</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> df.drop(columns <span class="op">=</span> [<span class="st">&#39;CLAIM_FLAG&#39;</span>, <span class="st">&#39;CLM_AMT&#39;</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then merge with the df_freq_sev</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> pd.merge(left <span class="op">=</span> df_freq_sev, right<span class="op">=</span>df_merged, how <span class="op">=</span> <span class="st">&#39;left&#39;</span>, on <span class="op">=</span> <span class="st">&#39;ID&#39;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df_final</span></code></pre></div>
<div class="output execute_result" data-execution_count="9">

  <div id="df-44388dd3-5396-4fa5-8820-812debde88b4" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>FREQUENCY</th>
      <th>SEVERITY</th>
      <th>KIDSDRIV</th>
      <th>AGE</th>
      <th>HOMEKIDS</th>
      <th>YOJ</th>
      <th>INCOME</th>
      <th>PARENT1</th>
      <th>HOME_VAL</th>
      <th>...</th>
      <th>CAR_USE</th>
      <th>BLUEBOOK</th>
      <th>TIF</th>
      <th>CAR_TYPE</th>
      <th>RED_CAR</th>
      <th>OLDCLAIM</th>
      <th>CLM_FREQ</th>
      <th>REVOKED</th>
      <th>MVR_PTS</th>
      <th>CAR_AGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>63175</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>50.0</td>
      <td>0</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>No</td>
      <td>282453.0</td>
      <td>...</td>
      <td>Private</td>
      <td>16740.0</td>
      <td>4</td>
      <td>Minivan</td>
      <td>no</td>
      <td>0.0</td>
      <td>0</td>
      <td>Yes</td>
      <td>0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>246910</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>33.0</td>
      <td>1</td>
      <td>8.0</td>
      <td>53598.0</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>...</td>
      <td>Private</td>
      <td>11410.0</td>
      <td>1</td>
      <td>SUV</td>
      <td>no</td>
      <td>9867.0</td>
      <td>4</td>
      <td>No</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>401276</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>53.0</td>
      <td>0</td>
      <td>13.0</td>
      <td>23847.0</td>
      <td>No</td>
      <td>108261.0</td>
      <td>...</td>
      <td>Private</td>
      <td>17970.0</td>
      <td>7</td>
      <td>SUV</td>
      <td>no</td>
      <td>0.0</td>
      <td>0</td>
      <td>No</td>
      <td>2</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>813128</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>44.0</td>
      <td>2</td>
      <td>15.0</td>
      <td>NaN</td>
      <td>No</td>
      <td>186500.0</td>
      <td>...</td>
      <td>Commercial</td>
      <td>10600.0</td>
      <td>17</td>
      <td>Pickup</td>
      <td>no</td>
      <td>0.0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>813128</td>
      <td>0</td>
      <td>0.0</td>
      <td>1</td>
      <td>46.0</td>
      <td>0</td>
      <td>12.0</td>
      <td>45018.0</td>
      <td>No</td>
      <td>0.0</td>
      <td>...</td>
      <td>Private</td>
      <td>15060.0</td>
      <td>4</td>
      <td>Minivan</td>
      <td>no</td>
      <td>33026.0</td>
      <td>3</td>
      <td>No</td>
      <td>0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10297</th>
      <td>999577084</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>56.0</td>
      <td>0</td>
      <td>10.0</td>
      <td>99606.0</td>
      <td>No</td>
      <td>NaN</td>
      <td>...</td>
      <td>Private</td>
      <td>9050.0</td>
      <td>6</td>
      <td>Pickup</td>
      <td>no</td>
      <td>0.0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>10298</th>
      <td>999640290</td>
      <td>0</td>
      <td>0.0</td>
      <td>2</td>
      <td>45.0</td>
      <td>2</td>
      <td>13.0</td>
      <td>33464.0</td>
      <td>No</td>
      <td>153488.0</td>
      <td>...</td>
      <td>Private</td>
      <td>6000.0</td>
      <td>6</td>
      <td>Pickup</td>
      <td>yes</td>
      <td>2883.0</td>
      <td>1</td>
      <td>No</td>
      <td>7</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10299</th>
      <td>999800537</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>45.0</td>
      <td>0</td>
      <td>12.0</td>
      <td>71076.0</td>
      <td>No</td>
      <td>216234.0</td>
      <td>...</td>
      <td>Private</td>
      <td>8610.0</td>
      <td>5</td>
      <td>SUV</td>
      <td>no</td>
      <td>3300.0</td>
      <td>1</td>
      <td>No</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10300</th>
      <td>999926368</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>46.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>57456.0</td>
      <td>No</td>
      <td>207400.0</td>
      <td>...</td>
      <td>Private</td>
      <td>12520.0</td>
      <td>6</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>0.0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>10301</th>
      <td>999926368</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>46.0</td>
      <td>0</td>
      <td>11.0</td>
      <td>57456.0</td>
      <td>No</td>
      <td>207400.0</td>
      <td>...</td>
      <td>Private</td>
      <td>15160.0</td>
      <td>1</td>
      <td>Minivan</td>
      <td>yes</td>
      <td>0.0</td>
      <td>0</td>
      <td>No</td>
      <td>0</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
<p>10302 rows √ó 25 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-44388dd3-5396-4fa5-8820-812debde88b4')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-44388dd3-5396-4fa5-8820-812debde88b4 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-44388dd3-5396-4fa5-8820-812debde88b4');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-10f950c0-c1b2-4767-b834-c057d694aa36">
      <button class="colab-df-quickchart" onclick="quickchart('df-10f950c0-c1b2-4767-b834-c057d694aa36')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-10f950c0-c1b2-4767-b834-c057d694aa36 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

  <div id="id_4b22ba39-ecf1-45b2-b90e-9982bce9883d">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df_final')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_4b22ba39-ecf1-45b2-b90e-9982bce9883d button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df_final');
      }
      })();
    </script>
  </div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="10"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="AoMw51L-Z5Yu" data-outputId="cc1cdfeb-64a9-45ac-9533-eda4a224d356">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Saco los duplicados</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_final.drop_duplicates(inplace<span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_final.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 10301 entries, 0 to 10301
Data columns (total 25 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   ID          10301 non-null  int64  
 1   FREQUENCY   10301 non-null  int64  
 2   SEVERITY    10301 non-null  float64
 3   KIDSDRIV    10301 non-null  int64  
 4   AGE         10294 non-null  float64
 5   HOMEKIDS    10301 non-null  int64  
 6   YOJ         9753 non-null   float64
 7   INCOME      9731 non-null   float64
 8   PARENT1     10301 non-null  object 
 9   HOME_VAL    9726 non-null   float64
 10  MSTATUS     10301 non-null  object 
 11  GENDER      10301 non-null  object 
 12  EDUCATION   10301 non-null  object 
 13  OCCUPATION  9636 non-null   object 
 14  TRAVTIME    10301 non-null  int64  
 15  CAR_USE     10301 non-null  object 
 16  BLUEBOOK    10301 non-null  float64
 17  TIF         10301 non-null  int64  
 18  CAR_TYPE    10301 non-null  object 
 19  RED_CAR     10301 non-null  object 
 20  OLDCLAIM    10301 non-null  float64
 21  CLM_FREQ    10301 non-null  int64  
 22  REVOKED     10301 non-null  object 
 23  MVR_PTS     10301 non-null  int64  
 24  CAR_AGE     9662 non-null   float64
dtypes: float64(8), int64(8), object(9)
memory usage: 2.0+ MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="11"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:868}"
id="y5w_He3SslyN" data-outputId="90fe1584-d93b-41c0-babb-aea2bbd7fac0">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imputo los NaN</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Uso la mediana para num√©ricas y &quot;Desconocido&quot; para categ√≥ricas.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df_final.columns:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_final[col].dtype <span class="kw">in</span> [<span class="st">&quot;float64&quot;</span>, <span class="st">&quot;int64&quot;</span>]:</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        df_final[col] <span class="op">=</span> df_final[col].fillna(df_final[col].median())</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        df_final[col] <span class="op">=</span> df_final[col].fillna(df_final[col].mode())</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df_final.isna().<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="11">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ID</th>
      <td>0</td>
    </tr>
    <tr>
      <th>FREQUENCY</th>
      <td>0</td>
    </tr>
    <tr>
      <th>SEVERITY</th>
      <td>0</td>
    </tr>
    <tr>
      <th>KIDSDRIV</th>
      <td>0</td>
    </tr>
    <tr>
      <th>AGE</th>
      <td>0</td>
    </tr>
    <tr>
      <th>HOMEKIDS</th>
      <td>0</td>
    </tr>
    <tr>
      <th>YOJ</th>
      <td>0</td>
    </tr>
    <tr>
      <th>INCOME</th>
      <td>0</td>
    </tr>
    <tr>
      <th>PARENT1</th>
      <td>0</td>
    </tr>
    <tr>
      <th>HOME_VAL</th>
      <td>0</td>
    </tr>
    <tr>
      <th>MSTATUS</th>
      <td>0</td>
    </tr>
    <tr>
      <th>GENDER</th>
      <td>0</td>
    </tr>
    <tr>
      <th>EDUCATION</th>
      <td>0</td>
    </tr>
    <tr>
      <th>OCCUPATION</th>
      <td>665</td>
    </tr>
    <tr>
      <th>TRAVTIME</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CAR_USE</th>
      <td>0</td>
    </tr>
    <tr>
      <th>BLUEBOOK</th>
      <td>0</td>
    </tr>
    <tr>
      <th>TIF</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CAR_TYPE</th>
      <td>0</td>
    </tr>
    <tr>
      <th>RED_CAR</th>
      <td>0</td>
    </tr>
    <tr>
      <th>OLDCLAIM</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CLM_FREQ</th>
      <td>0</td>
    </tr>
    <tr>
      <th>REVOKED</th>
      <td>0</td>
    </tr>
    <tr>
      <th>MVR_PTS</th>
      <td>0</td>
    </tr>
    <tr>
      <th>CAR_AGE</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div><br><label><b>dtype:</b> int64</label>
</div>
</div>
<div class="cell code" data-execution_count="12"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="zP8-ZnbkWT5o" data-outputId="4662d540-73a3-4b61-d70a-19dbe366c467">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_final.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="12">
<pre><code>(10301, 25)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="13"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="I_PzQoCTBIhg" data-outputId="884721e1-9ae5-4fd5-afde-14452a75a261">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr, spearmanr</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --- util: correlation ratio (eta) para categ√≥rica vs num√©rica ---</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correlation_ratio_cat_num(categories, values):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># categories: Serie categ√≥rica (str/object/category)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># values: Serie num√©rica</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># devuelve eta en [0,1]</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    cat <span class="op">=</span> pd.Categorical(categories)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> pd.Series(values).astype(<span class="bu">float</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> (<span class="op">~</span>pd.isna(cat.codes)) <span class="op">&amp;</span> (<span class="op">~</span>y.isna())</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> cat.codes[mask]</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> y[mask]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    overall_mean <span class="op">=</span> y.mean()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># between-groups</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    ss_between <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cat.categories)):</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        yk <span class="op">=</span> y[codes <span class="op">==</span> k]</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(yk) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>            ss_between <span class="op">+=</span> <span class="bu">len</span>(yk) <span class="op">*</span> (yk.mean() <span class="op">-</span> overall_mean) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># total</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    ss_total <span class="op">=</span> ((y <span class="op">-</span> overall_mean) <span class="op">**</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ss_total <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    eta <span class="op">=</span> np.sqrt(ss_between <span class="op">/</span> ss_total)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(eta)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correlations_vs_targets_simple(df, targets<span class="op">=</span>(<span class="st">&quot;FREQUENCY&quot;</span>,<span class="st">&quot;SEVERITY&quot;</span>)):</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Calcula y consolida el coeficiente final (Pearson o Eta) por feature.&quot;&quot;&quot;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Separar tipos de columnas</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> df.columns <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> targets <span class="kw">and</span> pd.api.types.is_numeric_dtype(df[c])]</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    cat_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> df.columns <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> targets <span class="kw">and</span> <span class="kw">not</span> pd.api.types.is_numeric_dtype(df[c])]</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    out_rows <span class="op">=</span> []</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tgt <span class="kw">in</span> targets:</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> df[tgt]</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Num√©ricas: Coeficiente Pearson</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> num_cols:</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> df[col]</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            mask <span class="op">=</span> <span class="op">~</span>(x.isna() <span class="op">|</span> y.isna())</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>            r <span class="op">=</span> np.nan</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">&gt;=</span> <span class="dv">3</span>:</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>                r, _ <span class="op">=</span> pearsonr(x[mask], y[mask])</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Almacenar el resultado en el campo &#39;score&#39;</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>            out_rows.append({<span class="st">&quot;feature&quot;</span>: col, <span class="st">&quot;target&quot;</span>: tgt, <span class="st">&quot;score&quot;</span>: r})</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Categ√≥ricas: Coeficiente Eta</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> cat_cols:</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>            eta <span class="op">=</span> correlation_ratio_cat_num(df[col], y) <span class="co"># Asume que esta funci√≥n est√° definida</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Almacenar el resultado en el campo &#39;score&#39;</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>            out_rows.append({<span class="st">&quot;feature&quot;</span>: col, <span class="st">&quot;target&quot;</span>: tgt, <span class="st">&quot;score&quot;</span>: eta})</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Devolver un DataFrame con solo feature, target, y score</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pd.DataFrame(out_rows)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>corr_table <span class="op">=</span> correlations_vs_targets_simple(df_final, targets<span class="op">=</span>(<span class="st">&quot;FREQUENCY&quot;</span>,<span class="st">&quot;SEVERITY&quot;</span>))</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="co"># === PROCESAMIENTO FINAL Y SALIDA ===</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Seleccionar y Ordenar para FREQUENCY</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>top_freq <span class="op">=</span> (corr_table[corr_table[<span class="st">&quot;target&quot;</span>]<span class="op">==</span><span class="st">&quot;FREQUENCY&quot;</span>]</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>            .sort_values(<span class="st">&quot;score&quot;</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Seleccionar y Ordenar para SEVERITY</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>top_sev <span class="op">=</span> (corr_table[corr_table[<span class="st">&quot;target&quot;</span>]<span class="op">==</span><span class="st">&quot;SEVERITY&quot;</span>]</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>            .sort_values(<span class="st">&quot;score&quot;</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SALIDA M√çNIMA REQUERIDA ---</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Salida para FREQUENCY</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== TOP CORRELATIONS VS. FREQUENCY ===&quot;</span>)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Muestra solo el nombre de la columna y el coeficiente (score)</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> top_freq[[<span class="st">&quot;feature&quot;</span>, <span class="st">&quot;score&quot;</span>]].head(<span class="dv">10</span>).iterrows():</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>row[<span class="st">&#39;feature&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[<span class="st">&#39;score&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Salida para SEVERITY</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== TOP CORRELATIONS VS. SEVERITY ===&quot;</span>)</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Muestra solo el nombre de la columna y el coeficiente (score)</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> top_sev[[<span class="st">&quot;feature&quot;</span>, <span class="st">&quot;score&quot;</span>]].head(<span class="dv">10</span>).iterrows():</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>row[<span class="st">&#39;feature&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[<span class="st">&#39;score&#39;</span>]<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>
=== TOP CORRELATIONS VS. FREQUENCY ===
MVR_PTS: 0.2029
CLM_FREQ: 0.1981
OCCUPATION: 0.1900
EDUCATION: 0.1609
PARENT1: 0.1570
REVOKED: 0.1403
MSTATUS: 0.1377
OLDCLAIM: 0.1267
HOMEKIDS: 0.1211
CAR_USE: 0.1205

=== TOP CORRELATIONS VS. SEVERITY ===
MVR_PTS: 0.1405
CLM_FREQ: 0.1228
OCCUPATION: 0.1078
PARENT1: 0.1050
MSTATUS: 0.0910
CAR_USE: 0.0890
OLDCLAIM: 0.0784
HOMEKIDS: 0.0751
EDUCATION: 0.0743
KIDSDRIV: 0.0729
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="14"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="4R87jmHBeBMV" data-outputId="fdd34f5e-8b27-4893-bd9d-c0353d976ab8">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hist_num_vs_num(df, var_x, var_y, gridsize<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    plt.hexbin(df[var_x], df[var_y], gridsize<span class="op">=</span>gridsize, cmap<span class="op">=</span><span class="st">&quot;ocean&quot;</span>, mincnt<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(label<span class="op">=</span><span class="st">&#39;Densidad&#39;</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(var_x)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(var_y)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;Densidad conjunta: </span><span class="sc">{</span>var_x<span class="sc">}</span><span class="ss"> vs </span><span class="sc">{</span>var_y<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>hist_num_vs_num(df_final, <span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;FREQUENCY&quot;</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hist_num_vs_cat(df, var_num, var_cat, bins<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    categorias <span class="op">=</span> df[var_cat].dropna().unique()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat <span class="kw">in</span> categorias:</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df[df[var_cat] <span class="op">==</span> cat][var_num].dropna()</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        plt.hist(subset, bins<span class="op">=</span>bins, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="ss">f&quot;</span><span class="sc">{</span>var_cat<span class="sc">}</span><span class="ss">=</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;Distribuci√≥n de </span><span class="sc">{</span>var_num<span class="sc">}</span><span class="ss"> seg√∫n </span><span class="sc">{</span>var_cat<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(var_num)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;Frecuencia&quot;</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/c4ef0ae1b9e18e61ba83eaf966fd0f3a7e30aaae.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="15"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="JcnpZPiseoZh" data-outputId="269d0a38-f1c4-4094-fa9f-8555a1d1c02a">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>hist_num_vs_num(df_final, <span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;SEVERITY&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/908bab8d995fe71ac1023f48209c20ba51cceda7.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="16"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="9lI-6c0efjVw" data-outputId="fadcde36-870e-4b3b-aeb3-90f20a968cc5">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hist_num_vs_num(df_final, <span class="st">&quot;MVR_PTS&quot;</span>, <span class="st">&quot;SEVERITY&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/be6b85598749bf94a0e858153407ebfa9484bea7.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="17"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="Ayy2qSLBHd8Y" data-outputId="09cf07e1-382f-4462-9398-bf20ee92bbd3">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># columnas con mayor poder explicativo</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>columnas_deseadas <span class="op">=</span> [</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;MVR_PTS&#39;</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;CLM_FREQ&#39;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;OCCUPATION&#39;</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;EDUCATION&#39;</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;PARENT1&#39;</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;REVOKED&#39;</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;MSTATUS&#39;</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;OLDCLAIM&#39;</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;HOMEKIDS&#39;</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;CAR_USE&#39;</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;AGE&#39;</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;FREQUENCY&#39;</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;SEVERITY&#39;</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ID&#39;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> df_final[columnas_deseadas]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Columnas en el nuevo df_final:&quot;</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_final.columns.tolist())</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Nueva forma del DataFrame: </span><span class="sc">{</span>df_final<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Columnas en el nuevo df_final:
[&#39;MVR_PTS&#39;, &#39;CLM_FREQ&#39;, &#39;OCCUPATION&#39;, &#39;EDUCATION&#39;, &#39;PARENT1&#39;, &#39;REVOKED&#39;, &#39;MSTATUS&#39;, &#39;OLDCLAIM&#39;, &#39;HOMEKIDS&#39;, &#39;CAR_USE&#39;, &#39;AGE&#39;, &#39;FREQUENCY&#39;, &#39;SEVERITY&#39;, &#39;ID&#39;]
Nueva forma del DataFrame: (10301, 14)
</code></pre>
</div>
</div>
<div class="cell markdown" id="kiFKQBHhZ8C4">
<p>TRAIN TEST SPLIT</p>
</div>
<div class="cell code" data-execution_count="18" id="vg2-KFBwZ9Kn">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train_data, test_data <span class="op">=</span> train_test_split(df_final, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="19" id="t3h_0FiuZ_x0">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_xgb_model(params):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xgb.XGBRegressor(<span class="op">**</span>params)</span></code></pre></div>
</div>
<div class="cell markdown" id="XQxcvkaSbwKA">
<hr />
</div>
<section id="modelo-de-frecuencia" class="cell markdown"
id="6IqiM4aVaFL1">
<h1><strong>MODELO DE FRECUENCIA</strong></h1>
</section>
<div class="cell code" data-execution_count="20"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:501}"
id="6oBtJ4wIaEWe" data-outputId="ad3676e0-da6e-4e5c-fe32-2494311482e1">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> df_final[<span class="st">&#39;FREQUENCY&#39;</span>].value_counts().sort_index()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;seaborn-v0_8-whitegrid&#39;</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">5</span>))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.bar(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    counts.index,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    counts.values,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;lightblue&#39;</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    counts.index, <span class="co"># Posiciones de los ticks (centradas autom√°ticamente)</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>counts.index.astype(<span class="bu">int</span>) <span class="co"># Los labels son los valores de frecuencia</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Etiquetas y T√≠tulos Acad√©micos</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Distribuci√≥n Emp√≠rica de la Frecuencia de Siniestros&#39;</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Frecuencia de Siniestros Observada&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Conteo de Observaciones&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>plt.xlim(left<span class="op">=-</span><span class="fl">0.5</span>, right<span class="op">=</span>counts.index.<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.5</span>)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/340b9b57fcd9d81a563928c51c10d82e081e180d.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="21" id="eax1EQ8paQDU">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_for_freq(train_data, test_data):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1) X / y</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> train_data.drop([<span class="st">&#39;FREQUENCY&#39;</span>, <span class="st">&#39;ID&#39;</span>, <span class="st">&#39;SEVERITY&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>).copy() <span class="co">#elimino todas las columnas que no se usan como explicativas del modelo</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> train_data[<span class="st">&#39;FREQUENCY&#39;</span>].copy()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    X_test  <span class="op">=</span> test_data.drop([<span class="st">&#39;FREQUENCY&#39;</span>, <span class="st">&#39;ID&#39;</span>, <span class="st">&#39;SEVERITY&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>).copy()</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    y_test  <span class="op">=</span> test_data[<span class="st">&#39;FREQUENCY&#39;</span>].copy()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#variables categ√≥ricas vs. num√©ricas</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    cat_cols <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">&#39;object&#39;</span>, <span class="st">&#39;category&#39;</span>]).columns.tolist() <span class="co">#columnas explicativas categ√≥ricas</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> X_train.columns <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> cat_cols] <span class="co">#columnas explicativas num√©ricas</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Target Encoding SOLO en categ√≥ricas.</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lo que hace el target encoding es que dentro de los distintos valores que puede tomar una columna, al valor categ√≥rico que tiene mayor frecuencia lo reemplaza un n√∫mero mayor.</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cat_cols) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        encoder <span class="op">=</span> TargetEncoder(</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>            cols<span class="op">=</span>cat_cols,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>            smoothing<span class="op">=</span><span class="dv">10</span>,            <span class="co"># suaviza vs media global</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>            min_samples_leaf<span class="op">=</span><span class="dv">50</span>,     <span class="co"># evita overfitting</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>            handle_unknown<span class="op">=</span><span class="st">&#39;value&#39;</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>            handle_missing<span class="op">=</span><span class="st">&#39;value&#39;</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        X_train_cat <span class="op">=</span> encoder.fit_transform(X_train[cat_cols], y_train)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        X_test_cat  <span class="op">=</span> encoder.transform(X_test[cat_cols])</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>        X_train_cat <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>X_train.index)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>        X_test_cat  <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>X_test.index)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combino num√©ricas + categ√≥ricas codificadas reemplazadas por n√∫meros</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    X_train_encoded <span class="op">=</span> pd.concat(</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        [X_train[num_cols].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>         X_train_cat.reset_index(drop<span class="op">=</span><span class="va">True</span>)],</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    X_test_encoded <span class="op">=</span> pd.concat(</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>        [X_test[num_cols].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>         X_test_cat.reset_index(drop<span class="op">=</span><span class="va">True</span>)],</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train_encoded, X_test_encoded, y_train, y_test</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_test_freq(model, train_data, test_data):</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> preprocess_for_freq(train_data, test_data) <span class="co">#llama a la funci√≥n que prepara los datos</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Control para ver si el split train/test qued√≥ balanceado --- (que no haya diferencia grande entre las medias)</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;--- Validaci√≥n de la Divisi√≥n en train y test (y) ---&#39;</span>)</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Media y_train: </span><span class="sc">{</span>y_train<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Media y_test:  </span><span class="sc">{</span>y_test<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;-------------------------------------&#39;</span>)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    model_fit <span class="op">=</span> model.fit(X_train, y_train) <span class="co">#entreno/ajusto el modelo con un regresor, en este caso XGBoost</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model_fit.predict(X_test) <span class="co">#Genera predicciones de frecuencia para los datos de </span><span class="al">TEST</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co">#--- M√©tricas</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    bias_pct <span class="op">=</span> (y_pred.mean() <span class="op">-</span> y_test.mean()) <span class="op">/</span> <span class="bu">max</span>(y_test.mean(), <span class="fl">1e-12</span>) <span class="co">#m√©trica para ver si se sobreestima o subestima la media</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred))</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> (mean_absolute_error(y_test, y_pred))</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Sesgo de la media: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>bias_pct<span class="sc">:.3f}</span><span class="ss">%&#39;</span>)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;RMSE: </span><span class="sc">{</span>rmse<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;MAE: </span><span class="sc">{</span>mae<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;R¬≤: </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">&#39;</span>)</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model_fit, y_pred, y_test</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="22" id="Qfc7HpYLaW0H">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>xgb_freq_params <span class="op">=</span> {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;objective&#39;</span>: <span class="st">&#39;count:poisson&#39;</span>,  <span class="co"># para FREQUENCY en [0,1]</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;learning_rate&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_depth&#39;</span>: <span class="dv">5</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;n_estimators&#39;</span>: <span class="dv">250</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;subsample&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;colsample_bytree&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;reg_lambda&#39;</span>: <span class="fl">1.0</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;random_state&#39;</span>: <span class="dv">42</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>xgb_freq_model <span class="op">=</span> create_xgb_model(xgb_freq_params)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="23"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="WvizZjvHabHx" data-outputId="a4fd7b35-7c7f-49f9-ee6a-d8662bf55b7a">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model_freq, preds_freq, y_test_freq <span class="op">=</span> train_test_freq(xgb_freq_model, train_data, test_data)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;--- Valor esperado real de la frecuencia de una p√≥liza ---&#39;</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Media real: </span><span class="sc">{</span>df_final[<span class="st">&#39;FREQUENCY&#39;</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>--- Validaci√≥n de la Divisi√≥n en train y test (y) ---
Media y_train: 0.350728
Media y_test:  0.361475
-------------------------------------
Sesgo de la media: -3.081%
RMSE: 0.518716
MAE: 0.402989
R¬≤: 0.1331
--- Valor esperado real de la frecuencia de una p√≥liza ---
Media real: 0.352878
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="24"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="NEHWUpA6g7DR" data-outputId="b6cc6d33-ec0b-49c6-8ffc-65445ddd1696">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_completo <span class="op">=</span> test_data.copy()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos a numpy (garantiza forma 1D)</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>y_real <span class="op">=</span> np.array(y_test_freq).ravel()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.array(preds_freq).ravel()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos columnas</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>df_completo[<span class="st">&quot;y_real&quot;</span>] <span class="op">=</span> y_real</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>df_completo[<span class="st">&quot;y_predicho&quot;</span>] <span class="op">=</span> y_pred</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>df_completo[<span class="st">&quot;error_abs&quot;</span>] <span class="op">=</span> <span class="bu">abs</span>(df_completo[<span class="st">&quot;y_real&quot;</span>] <span class="op">-</span> df_completo[<span class="st">&quot;y_predicho&quot;</span>])</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>df_completo[<span class="st">&quot;error_rel&quot;</span>] <span class="op">=</span> df_completo[<span class="st">&quot;error_abs&quot;</span>] <span class="op">/</span> (df_completo[<span class="st">&quot;y_real&quot;</span>] <span class="op">+</span> <span class="fl">1e-6</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Vista preliminar</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_completo.head())</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>       MVR_PTS  CLM_FREQ   OCCUPATION    EDUCATION PARENT1 REVOKED MSTATUS  \
3101         0         0      Manager          PhD     Yes      No      No   
10109        1         3  Blue Collar    Bachelors      No      No     Yes   
7445         4         3     Clerical  High School     Yes      No      No   
7769         3         2       Doctor          PhD      No     Yes     Yes   
3306         1         0          NaN      Masters     Yes      No      No   

       OLDCLAIM  HOMEKIDS     CAR_USE   AGE  FREQUENCY  SEVERITY         ID  \
3101        0.0         3     Private  31.0          0       0.0  299191262   
10109    5699.0         3  Commercial  42.0          1    1107.0  978551833   
7445     5316.0         2     Private  38.0          0       0.0  713692930   
7769    19217.0         0     Private  50.0          0       0.0  743146596   
3306        0.0         1  Commercial  34.0          1    4093.0  317381589   

       y_real  y_predicho  error_abs      error_rel  
3101        0    0.373888   0.373888  373888.254166  
10109       1    0.541486   0.458514       0.458513  
7445        0    0.687485   0.687485  687485.098839  
7769        0    0.122109   0.122109  122108.772397  
3306        1    0.436346   0.563654       0.563653  
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="25"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="MlABnxPzwyVR" data-outputId="ee0fde4f-7267-422c-bd7f-50f0863c0fae">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>valor_esp_frecuencia <span class="op">=</span> preds_freq.mean()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Valor esperado de frecuencia de una p√≥liza: </span><span class="sc">{</span>valor_esp_frecuencia<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Valor esperado de frecuencia de una p√≥liza: 0.350339
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="26"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="J2WgcMFc0mOb" data-outputId="ebfe0f29-5855-4994-a3d9-9690e90bb89a">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_freq <span class="op">=</span> pd.DataFrame({</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;y_true&quot;</span>: y_test_freq,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;y_pred&quot;</span>: preds_freq</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>df_freq[<span class="st">&quot;decile&quot;</span>] <span class="op">=</span> pd.qcut(df_freq[<span class="st">&quot;y_pred&quot;</span>], <span class="dv">10</span>, duplicates<span class="op">=</span><span class="st">&quot;drop&quot;</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>calib <span class="op">=</span> df_freq.groupby(<span class="st">&quot;decile&quot;</span>)[[<span class="st">&quot;y_true&quot;</span>,<span class="st">&quot;y_pred&quot;</span>]].mean().reset_index()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(calib)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>           decile    y_true    y_pred
0  (0.049, 0.113]  0.091787  0.084811
1  (0.113, 0.149]  0.140777  0.130334
2  (0.149, 0.184]  0.145631  0.164831
3  (0.184, 0.229]  0.257282  0.205545
4  (0.229, 0.288]  0.320388  0.257346
5  (0.288, 0.356]  0.349515  0.320126
6  (0.356, 0.442]  0.417476  0.399233
7  (0.442, 0.555]  0.514563  0.495660
8  (0.555, 0.686]  0.631068  0.614058
9  (0.686, 1.376]  0.747573  0.832735
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>/tmp/ipython-input-1715707709.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  calib = df_freq.groupby(&quot;decile&quot;)[[&quot;y_true&quot;,&quot;y_pred&quot;]].mean().reset_index()
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="27"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:670}"
id="vZ80JGrS1C06" data-outputId="91ddf21b-ebc5-4a36-ea52-9e89ab67e630">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Los datos proporcionados se ingresan en un DataFrame de pandas</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(calib)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;decil_idx&#39;</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df) <span class="op">+</span> <span class="dv">1</span>) <span class="co"># Crear un √≠ndice num√©rico para el eje X</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparaci√≥n de y_true vs y_pred por Decil (Calibraci√≥n y Discriminaci√≥n)</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">&#39;decil_idx&#39;</span>, y<span class="op">=</span><span class="st">&#39;y_true&#39;</span>, data<span class="op">=</span>df, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, label<span class="op">=</span><span class="vs">r&#39;Valor Real Promedio ($\mathbf{y_</span><span class="sc">{true}</span><span class="vs">}$)&#39;</span>, color<span class="op">=</span><span class="st">&#39;tab:blue&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">&#39;decil_idx&#39;</span>, y<span class="op">=</span><span class="st">&#39;y_pred&#39;</span>, data<span class="op">=</span>df, marker<span class="op">=</span><span class="st">&#39;x&#39;</span>, label<span class="op">=</span><span class="vs">r&#39;Valor Predicho Promedio ($\mathbf{y_</span><span class="sc">{pred}</span><span class="vs">}$)&#39;</span>, color<span class="op">=</span><span class="st">&#39;tab:red&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Calibraci√≥n del Modelo por Decil&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Decil (basado en $\mathbf{y_</span><span class="sc">{pred}</span><span class="st">}$)&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Valor Promedio&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(df[<span class="st">&#39;decil_idx&#39;</span>]) <span class="co"># Asegurar que las marcas son los n√∫meros de decil</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stderr">
<pre><code>&lt;&gt;:14: SyntaxWarning: invalid escape sequence &#39;\m&#39;
&lt;&gt;:14: SyntaxWarning: invalid escape sequence &#39;\m&#39;
/tmp/ipython-input-1439819098.py:14: SyntaxWarning: invalid escape sequence &#39;\m&#39;
  plt.xlabel(&#39;Decil (basado en $\mathbf{y_{pred}}$)&#39;, fontsize=12)
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/8c0823961885e9a80e0848a26d5611d54dd35b74.png" /></p>
</div>
</div>
<div class="cell markdown" id="FQ-OZjw5Onyc">
<p>Ya tengo el modelo de frecuencia de mi cartera, con un valor esperado
de 0,3566</p>
</div>
<div class="cell markdown" id="88aEXxEspQmg">
<p>hablar sobre MAE entre 0,3 y 0,6 Error aceptable en datos con conteos
bajos</p>
</div>
<div class="cell code" data-execution_count="28"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:407}"
id="1vnsGz1Z5isK" data-outputId="5cb2351c-bdcb-43ec-bd80-42385f3614bc">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;ggplot&#39;</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cols_posibles_drop <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> [<span class="st">&#39;FREQUENCY&#39;</span>,<span class="st">&#39;SEVERITY&#39;</span>,<span class="st">&#39;ID&#39;</span>] <span class="cf">if</span> c <span class="kw">in</span> train_data.columns]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>feat_names_freq <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> train_data.columns <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> cols_posibles_drop]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>imp <span class="op">=</span> <span class="bu">getattr</span>(model_freq, <span class="st">&quot;feature_importances_&quot;</span>, <span class="va">None</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> imp <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;El modelo de frecuencia no expone feature_importances_.&quot;</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si el modelo fue entrenado con columnas transformadas, puede no coincidir 1 a 1.</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tomamos el m√≠nimo com√∫n para evitar errores.</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(imp), <span class="bu">len</span>(feat_names_freq))</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    pares <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">list</span>(<span class="bu">zip</span>(feat_names_freq[:k], imp[:k])), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">10</span>]</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    labels, vals <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>pares) <span class="cf">if</span> pares <span class="cf">else</span> ([], [])</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>))</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.arange(<span class="bu">len</span>(labels))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gr√°fico de barras horizontales con el nuevo estilo</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    plt.barh(y, vals, color<span class="op">=</span><span class="st">&#39;teal&#39;</span>) <span class="co"># A√±ad√≠ un color para mejorar la visualizaci√≥n</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    plt.yticks(y, labels)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    plt.gca().invert_yaxis()</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Importancia&quot;</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&quot;Top-10 variables predictoras ‚Äî Modelo de Frecuencia (XGB)&quot;</span>)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Restablecer el estilo predeterminado despu√©s de mostrar el gr√°fico (opcional, pero buena pr√°ctica)</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;default&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/451f6ad41ddd55f066f99764cf927d250cf50d56.png" /></p>
</div>
</div>
<section id="modelo-de-severidad" class="cell markdown"
id="1oxvBs-2afQ8">
<h1>MODELO DE SEVERIDAD</h1>
</section>
<div class="cell code" data-execution_count="29"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="fxHmTnhWPawj" data-outputId="20dd25f6-649b-4045-9b29-79568a153930">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_final[<span class="st">&#39;SEVERITY&#39;</span>].<span class="bu">max</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="29">
<pre><code>123247.0</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="30"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:607}"
id="D8I8kieOaoPL" data-outputId="cf44d365-34e7-4603-8898-384d8cc17859">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Al graficar mis datos, vemos que la severidad toma la forma de una curva continua y sesgada a la derecha, lo que la hace compatible con una distribucion Gamma.</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#df_final[df_final[&#39;SEVERITY&#39;] != 0][&#39;SEVERITY&#39;].hist(bins = 100, range=(0, 46000))</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;seaborn-v0_8-whitegrid&#39;</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>plt.hist(</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    df_final[df_final[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">!=</span> <span class="dv">0</span>][<span class="st">&#39;SEVERITY&#39;</span>],</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>, <span class="dv">46000</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;lightblue&#39;</span>,</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>formatter <span class="op">=</span> ticker.StrMethodFormatter(<span class="st">&#39;{x:,.0f}&#39;</span>) <span class="co"># Formato con separadores de miles y cero decimales</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>plt.gca().xaxis.set_major_formatter(formatter)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Distribuci√≥n de la severidad de siniestros observados&#39;</span>,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Monto de la severidad&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frecuencia&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotar las etiquetas del eje X para mejor lectura de n√∫meros grandes</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">&#39;right&#39;</span>)</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/422aebda2ae9fa8b7f796c7ebc21304822331557.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="31" id="d1S93BgFatHS">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_for_sev(train_data, test_data):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filtro ceros (solo positivos para severidad)</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    train_nonzero <span class="op">=</span> train_data[train_data[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    test_nonzero  <span class="op">=</span> test_data[test_data[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  X / y</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> train_nonzero.drop([<span class="st">&#39;FREQUENCY&#39;</span>, <span class="st">&#39;ID&#39;</span>, <span class="st">&#39;SEVERITY&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> train_nonzero[<span class="st">&#39;SEVERITY&#39;</span>]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    X_test  <span class="op">=</span> test_nonzero.drop([<span class="st">&#39;FREQUENCY&#39;</span>, <span class="st">&#39;ID&#39;</span>, <span class="st">&#39;SEVERITY&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    y_test  <span class="op">=</span> test_nonzero[<span class="st">&#39;SEVERITY&#39;</span>]</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categ√≥ricas vs num√©ricas (ya ven√≠an imputadas)</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    cat_cols <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">&#39;object&#39;</span>,<span class="st">&#39;category&#39;</span>]).columns.tolist()</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> X_train.columns <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> cat_cols]</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Target Encoding SOLO en categ√≥ricas</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cat_cols) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>        encoder <span class="op">=</span> TargetEncoder(</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>            cols<span class="op">=</span>cat_cols, smoothing<span class="op">=</span><span class="dv">10</span>, min_samples_leaf<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>            handle_unknown<span class="op">=</span><span class="st">&#39;value&#39;</span>, handle_missing<span class="op">=</span><span class="st">&#39;value&#39;</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>        X_train_cat <span class="op">=</span> encoder.fit_transform(X_train[cat_cols], y_train)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>        X_test_cat  <span class="op">=</span> encoder.transform(X_test[cat_cols])   <span class="co"># &lt;- sin y_test</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>        X_train_cat <span class="op">=</span> X_train[[]].copy()</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>        X_test_cat  <span class="op">=</span> X_test[[]].copy()</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># matrices finales</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    X_train_enc <span class="op">=</span> pd.concat([X_train[num_cols].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>                             X_train_cat.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    X_test_enc  <span class="op">=</span> pd.concat([X_test[num_cols].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>                             X_test_cat.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train_enc, X_test_enc, y_train, y_test</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="32" id="PNO_3toLfsfF">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_test_sev(model, train_data, test_data):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> preprocess_for_sev(train_data, test_data)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;--- Validaci√≥n de la Divisi√≥n (y) ---&#39;</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Media y_train: </span><span class="sc">{</span>y_train<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">&#39;</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Media y_test:  </span><span class="sc">{</span>y_test<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">&#39;</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;------------------------------------&#39;</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    model_fit <span class="op">=</span> model.fit(X_train, y_train)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model_fit.predict(X_test)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sesgo media</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    bias <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> y_test.mean() <span class="op">/</span> y_pred.mean())</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred))</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    mae  <span class="op">=</span> mean_absolute_error(y_test, y_pred)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M√©tricas ROBUSTAS (recortadas 99¬∫ pto para que no dominen 1-2 outliers)</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    p99_y, p99_p <span class="op">=</span> np.percentile(y_test, <span class="dv">99</span>), np.percentile(y_pred, <span class="dv">99</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> (y_test <span class="op">&lt;=</span> p99_y) <span class="op">&amp;</span> (y_pred <span class="op">&lt;=</span> p99_p)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    rmse_rob <span class="op">=</span> np.sqrt(mean_squared_error(y_test[mask], y_pred[mask]))</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    mae_rob  <span class="op">=</span> mean_absolute_error(y_test[mask], y_pred[mask])</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Sesgo media: </span><span class="sc">{</span>bias<span class="sc">:.4f}</span><span class="ss">&#39;</span>)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;RMSE: </span><span class="sc">{</span>rmse<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss"> | MAE: </span><span class="sc">{</span>mae<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;RMSE(‚â§P99): </span><span class="sc">{</span>rmse_rob<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss"> | MAE(‚â§P99): </span><span class="sc">{</span>mae_rob<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;R¬≤: </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">&#39;</span>)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model_fit, y_pred, y_test, X_test</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="33"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="3A821RylfvOJ" data-outputId="14e88e09-ad2c-4db0-af03-240b0497ace3">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>xgb_sev_params <span class="op">=</span> {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;objective&#39;</span>: <span class="st">&#39;reg:gamma&#39;</span>,     <span class="co"># target severidad sigue una distribuci√≥n Gamma condicional a las covariables ùëã.</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;learning_rate&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_depth&#39;</span>: <span class="dv">4</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;n_estimators&#39;</span>: <span class="dv">600</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;subsample&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;colsample_bytree&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;reg_lambda&#39;</span>: <span class="fl">1.0</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;alpha&#39;</span>: <span class="dv">30</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;random_state&#39;</span>: <span class="dv">42</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>xgb_sev_model <span class="op">=</span> create_xgb_model(xgb_sev_params)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>model_sev, preds_sev, y_test_sev, X_test_sev <span class="op">=</span> train_test_sev(xgb_sev_model, train_data, test_data)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;--- Valor esperado real de la severidad de una p√≥liza ---&#39;</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Media REAL: </span><span class="sc">{</span>df_final[df_final[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">!=</span> <span class="dv">0</span>][<span class="st">&#39;SEVERITY&#39;</span>]<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>--- Validaci√≥n de la Divisi√≥n (y) ---
Media y_train: 4797.21
Media y_test:  4649.79
------------------------------------
Sesgo media: -0.0090
RMSE: 6,662.11 | MAE: 3,044.38
RMSE(‚â§P99): 4,012.88 | MAE(‚â§P99): 2,594.05
R¬≤: 0.0017
--- Valor esperado real de la severidad de una p√≥liza ---
Media REAL: 4767.013778
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="34"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:557}"
id="Wf2-RycugB1K" data-outputId="3ff7e48e-9974-4b5e-eb84-63391b65cf59">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">6</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(np.log(y_test_sev<span class="op">+</span>eps), np.log(preds_sev<span class="op">+</span>eps), alpha<span class="op">=</span><span class="fl">0.35</span>, s<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>mx <span class="op">=</span> <span class="bu">max</span>(np.log(y_test_sev<span class="op">+</span>eps).<span class="bu">max</span>(), np.log(preds_sev<span class="op">+</span>eps).<span class="bu">max</span>())</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, mx],[<span class="dv">0</span>, mx],<span class="st">&#39;r--&#39;</span>,lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;log(SEVERITY real)&quot;</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;log(SEVERITY pred)&quot;</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Severidad (Modelo XGBoost)&quot;</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/b911ec1030a5eb2e3af4ab310b7ec609c212200d.png" /></p>
</div>
</div>
<div class="cell markdown" id="1qoYglHPRdTh">
<p>Este gr√°fico nos muestra que el modelo describe bien el ‚Äúpromedio‚Äù
del comportamiento, pero pierde capacidad de ajuste en los siniestros de
alto valor.</p>
</div>
<div class="cell code" data-execution_count="35"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:461}"
id="iVuLGhIOzD2b" data-outputId="bf68b740-665e-4a32-cc15-3931dd0cc9f3">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;Empirical Cumulative Distribution Function&quot; - gr√°fico de probabilidad acumulada (a escala logar√≠tmica)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ecdf(a):</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.sort(a)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a, np.arange(<span class="dv">1</span>, a.size<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>a.size</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>x_y, F_y <span class="op">=</span> ecdf(np.log(y_test_sev<span class="op">+</span>eps))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>x_p, F_p <span class="op">=</span> ecdf(np.log(preds_sev<span class="op">+</span>eps))</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x_y, F_y, label<span class="op">=</span><span class="st">&#39;Real (escala log)&#39;</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x_p, F_p, <span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="st">&#39;Pred (escala log)&#39;</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Probabilidad Acumulada&quot;</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span> plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)<span class="op">;</span> plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/9a2f5c3a796a4e9e879e3f8dc729c8586c68046e.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="36"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:461}"
id="-y7WZkr8TcsW" data-outputId="599f8d8d-c298-40b6-b86a-6cd0fdee9f04">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;Empirical Cumulative Distribution Function&quot; - gr√°fico de probabilidad acumulada</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ecdf(a):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.sort(a)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a, np.arange(<span class="dv">1</span>, a.size<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>a.size</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>x_y, F_y <span class="op">=</span> ecdf(y_test_sev<span class="op">+</span>eps)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>x_p, F_p <span class="op">=</span> ecdf(preds_sev<span class="op">+</span>eps)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x_y, F_y, label<span class="op">=</span><span class="st">&#39;Real&#39;</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x_p, F_p, <span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="st">&#39;Pred&#39;</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Probabilidad Acumulada&quot;</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span> plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)<span class="op">;</span> plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/b15f965896a1f1002bedba2cb5db9109ea0efb8d.png" /></p>
</div>
</div>
<div class="cell markdown" id="2nX3_CVZS_Nc">
<p>Se puede observar que mirando la distribuci√≥n acumulada real vs.
predicha, el modelo capta correctamente la forma general de la
distribuci√≥n, pero no reproduce adecuadamente la variabilidad y la
dispersi√≥n de los valores que se encuentran en los extremos.</p>
</div>
<div class="cell code" data-execution_count="37"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="eLISD9U9Pqyd" data-outputId="51b5e653-cd8a-47d7-80e8-55ffd16738af">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Predicci√≥n M√≠nima del modelo XGBOOST: </span><span class="sc">{</span>preds_sev<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Predicci√≥n M√°xima del modelo XGBOOST: </span><span class="sc">{</span>preds_sev<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Valor m√°ximo real: </span><span class="sc">{</span>df_final[<span class="st">&#39;SEVERITY&#39;</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Predicci√≥n M√≠nima del modelo XGBOOST: 2945.84
Predicci√≥n M√°xima del modelo XGBOOST: 9407.77
Valor m√°ximo real: 123247.00
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="38"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="hCCNKKWLGG_b" data-outputId="f64ce9db-4c73-4b07-cf2b-ab92f532e133">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>VaR_dict <span class="op">=</span> {}</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>TVaR_dict <span class="op">=</span> {}</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> [<span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>]:</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    VaR_p <span class="op">=</span> np.percentile(preds_sev, <span class="dv">100</span> <span class="op">*</span> p)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    TVaR_p <span class="op">=</span> preds_sev[preds_sev <span class="op">&gt;=</span> VaR_p].mean()</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    VaR_dict[p] <span class="op">=</span> VaR_p</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    TVaR_dict[p] <span class="op">=</span> TVaR_p</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Medidas de riesgo del modelo XGBOOST:&quot;</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> [<span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>]:</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="bu">int</span>(p<span class="op">*</span><span class="dv">100</span>)<span class="sc">}</span><span class="ss">%&quot;</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;  VaR = </span><span class="sc">{</span>VaR_dict[p]<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;  TVaR = </span><span class="sc">{</span>TVaR_dict[p]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Medidas de riesgo del modelo XGBOOST:
95%
  VaR = 6250.62
  TVaR = 6905.61

99%
  VaR = 7271.92
  TVaR = 7990.50

99%
  VaR = 7648.34
  TVaR = 8410.23

</code></pre>
</div>
</div>
<div class="cell markdown" id="5s6lmrkHT6nE">
<hr />
<h2
id="modelo-mixto-machine-learning-y-teor√≠a-de-valores-extremos"><strong>Modelo
MIXTO: Machine Learning y Teor√≠a de Valores Extremos</strong></h2>
<hr />
</div>
<section id="-selecci√≥n-del-threshold" class="cell markdown"
id="4fsNI6llimAV">
<h2>üéØ SELECCI√ìN DEL THRESHOLD</h2>
</section>
<div class="cell markdown" id="VIOb3UJGiokO">
<p><strong>Mean Excess Plot</strong></p>
<p>e(u)=E[X‚àíu/X&gt;u]</p>
<p>Si los datos en la cola realmente siguen una Generalized Pareto
Distribution (GPD), el gr√°fico de e(u) en funci√≥n de u deber√≠a verse
aproximadamente lineal a partir de cierto punto.</p>
<p>Ese ‚Äúpunto de quiebre‚Äù (cuando pasa de curvado a casi lineal) es el
umbral candidato.</p>
</div>
<div class="cell code" data-execution_count="39"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:515}"
id="nNu8y2eZ8VNM" data-outputId="28da33bb-236a-40d8-d7be-cd330f169079">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter, LogLocator</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> human_format(x, pos<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;=</span> <span class="fl">1e6</span>: <span class="cf">return</span> <span class="ss">f&quot;</span><span class="sc">{</span>x<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss">M&quot;</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;=</span> <span class="fl">1e3</span>: <span class="cf">return</span> <span class="ss">f&quot;</span><span class="sc">{</span>x<span class="op">/</span><span class="fl">1e3</span><span class="sc">:.0f}</span><span class="ss">K&quot;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&quot;</span><span class="sc">{</span>x<span class="sc">:.0f}</span><span class="ss">&quot;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>claims <span class="op">=</span> df_final.loc[df_final[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">&#39;SEVERITY&#39;</span>].to_numpy()</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>claims <span class="op">=</span> claims[np.isfinite(claims)]</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_excess_and_count(data, thresholds):</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    mean_excesses, num_exceedances <span class="op">=</span> [], []</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> u <span class="kw">in</span> thresholds:</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>        exc <span class="op">=</span> data[data <span class="op">&gt;</span> u] <span class="op">-</span> u</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>        num_exceedances.append(exc.size)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>        mean_excesses.append(np.nan <span class="cf">if</span> exc.size <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> exc.mean())</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean_excesses, num_exceedances</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Umbrales</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>start_threshold <span class="op">=</span> np.percentile(claims, <span class="dv">80</span>)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>end_threshold   <span class="op">=</span> np.percentile(claims, <span class="dv">98</span>)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>thresholds <span class="op">=</span> np.linspace(start_threshold, end_threshold, <span class="dv">500</span>)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>e_values, n_exceedances <span class="op">=</span> mean_excess_and_count(claims, thresholds)</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Suavizado (media m√≥vil) ---</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> <span class="dv">15</span>  <span class="co"># cantidad de puntos del promedio m√≥vil</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>e_smooth <span class="op">=</span> pd.Series(e_values).rolling(window, center<span class="op">=</span><span class="va">True</span>, min_periods<span class="op">=</span><span class="dv">1</span>).mean()</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Gr√°fico ---</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> FuncFormatter(human_format)</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>xticks <span class="op">=</span> np.linspace(start_threshold, end_threshold, <span class="dv">8</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Excess Plot (suavizado)</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>ax1.plot(thresholds, e_values, lw<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.4</span>, color<span class="op">=</span><span class="st">&quot;tab:blue&quot;</span>, label<span class="op">=</span><span class="st">&quot;Original&quot;</span>)</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>ax1.plot(thresholds, e_smooth, lw<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">&quot;tab:blue&quot;</span>, label<span class="op">=</span><span class="st">&quot;Suavizado&quot;</span>)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&quot;Umbral u&quot;</span>)<span class="op">;</span> ax1.set_ylabel(<span class="st">&quot;Exceso Medio e(u)&quot;</span>)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&quot;Mean Excess Plot - Severidad&quot;</span>)</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, ls<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(xticks)</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>ax1.xaxis.set_major_formatter(fmt)</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>ax1.yaxis.set_major_formatter(fmt)</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Conteo de excedencias</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>ax2.plot(thresholds, n_exceedances, lw<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&quot;tab:red&quot;</span>)</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">&quot;Umbral u&quot;</span>)<span class="op">;</span> ax2.set_ylabel(<span class="st">&quot;N√∫mero de excedencias (log)&quot;</span>)</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&quot;Conteo de Excesos&quot;</span>)</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, ls<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>ax2.set_yscale(<span class="st">&quot;log&quot;</span>)</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(xticks)</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.set_major_formatter(fmt)</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>ax2.yaxis.set_major_locator(LogLocator(base<span class="op">=</span><span class="dv">10</span>))</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>ax2.yaxis.set_major_formatter(fmt)</span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/6c903c73bec0492601296b439c0cfaad6c79230a.png" /></p>
</div>
</div>
<div class="cell markdown" id="EN2UrLZi5tul">
<p>üëâ Antes del valor 10,000: <em>la curva es c√≥ncava y con pendiente
creciente pronunciada</em> ‚Üí esa zona todav√≠a pertenece al cuerpo de la
distribuci√≥n, no a la cola ‚Äúpura‚Äù. --&gt;</p>
<p>üéØ A partir de ‚âà 10,000 - 11,000: <strong>PUNTO DE QUIEBRE</strong>.
La pendiente comienza a estabilizarse y el crecimiento del exceso medio
se vuelve casi lineal, aunque con peque√±as fluctuaciones debidas a la
menor cantidad de observaciones.</p>
<p>El gr√°fico se aplaca y muestra fluctuaciones aleatorias y planas (una
tendencia constante, alrededor de 14K)</p>
<p>Este es el rango de umbral √≥ptimo para aplicar la GPD. Indica que,
para cualquier umbral u que elijas en esta zona (p. ej., $11K, $15K,
$17K), la media del exceso sobre ese umbral permanece esencialmente
constante (o ligeramente creciente).</p>
<p><em>Basado en el gr√°fico, un umbral de alrededor de $11,000 ser√≠a un
buen punto de partida.</em></p>
</div>
<div class="cell markdown" id="kIjlXdmS2eVt">
<p>Este an√°lisis es una prueba de robustez del modelo EVT.</p>
<p>El modelo es sensible a la elecci√≥n del umbral <span
class="math inline"><em>u</em></span>.</p>
<p>El umbral m√°s bajo (<span
class="math inline"><em>u</em>‚ÄÑ=‚ÄÑ7500</span>) resulta en el mayor riesgo
(VaR y TVaR) debido a que su GPD tiene el <span
class="math inline"><em>Œæ</em></span> m√°s alto, indicando una cola de
distribuci√≥n de p√©rdidas extremadamente pesada. Si se elige este umbral,
la estimaci√≥n del riesgo es la m√°s conservadora.</p>
<p>Los umbrales m√°s altos (<span
class="math inline"><em>u</em>‚ÄÑ=‚ÄÑ10000,‚ÄÜ<em>u</em>‚ÄÑ=‚ÄÑ11000</span> y
<span class="math inline"><em>u</em>‚ÄÑ=‚ÄÑ15000</span>) producen
estimaciones de VaR y TVaR similares entre s√≠, lo que sugiere que, para
la poblaci√≥n de siniestros por encima de <span
class="math inline">10000</span>, la distribuci√≥n de p√©rdidas extremas
es m√°s estable y ligera.</p>
<p>Para la toma de decisiones (por ejemplo, determinar una reserva de
capital), un actuario o gestor de riesgos probablemente favorecer√≠a el
umbral que ofrece los par√°metros de GPD m√°s estables, mientras que
tambi√©n considerar√≠a el nivel de conservaci√≥n deseado.</p>
</div>
<div class="cell code" data-execution_count="40"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:502}"
id="5TV-c0FglW2h" data-outputId="0a793911-6448-4aa0-c054-85dec95ef749">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- UMBRAL ---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">9407.77</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- SEPARACI√ìN CUERPO / COLA ---</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>body_claims <span class="op">=</span> claims[claims <span class="op">&lt;=</span> threshold]</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>tail_claims <span class="op">=</span> claims[claims <span class="op">&gt;</span> threshold]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Stats √∫tiles para el informe</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>n_total <span class="op">=</span> claims.size</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>n_tail  <span class="op">=</span> tail_claims.size</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>pct_tail <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> n_tail <span class="op">/</span> <span class="bu">max</span>(n_total, <span class="dv">1</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co"># GR√ÅFICOS</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">7</span>))</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot 1: Distribuci√≥n completa con umbral ---</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>bins_full <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.percentile(claims, <span class="fl">99.9</span>), <span class="dv">300</span>)  <span class="co"># ajustado al rango real de tus datos</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>sns.histplot(body_claims, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;navy&#39;</span>, label<span class="op">=</span><span class="st">&#39;Cuerpo&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>sns.histplot(tail_claims, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;steelblue&#39;</span>, label<span class="op">=</span><span class="st">&#39;Cola&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">&#39;sienna&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;Umbral ($</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&#39;</span>)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&#39;Monto del Siniestro&#39;</span>)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">&#39;Frecuencia&#39;</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;Distribuci√≥n completa con umbral&#39;</span>)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>ax1.set_yscale(<span class="st">&#39;log&#39;</span>)  <span class="co"># √∫til para ver la cola</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>ax1.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>ax1.xaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>ax1.yaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="dv">0</span>, np.percentile(claims, <span class="fl">99.9</span>))</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota en el gr√°fico con #excesos</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>ax1.text(<span class="fl">0.98</span>, <span class="fl">0.95</span>, <span class="ss">f&#39;Excesos &gt; u: </span><span class="sc">{</span>n_tail<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>pct_tail<span class="sc">:.2f}</span><span class="ss">%)&#39;</span>,</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>         transform<span class="op">=</span>ax1.transAxes, ha<span class="op">=</span><span class="st">&#39;right&#39;</span>, va<span class="op">=</span><span class="st">&#39;top&#39;</span>, fontsize<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>         bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">&#39;round&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>))</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot 2: Vista ampliada de la cola ---</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>sns.histplot(tail_claims, bins<span class="op">=</span><span class="dv">200</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&#39;steelblue&#39;</span>, ax<span class="op">=</span>ax2, stat<span class="op">=</span><span class="st">&#39;density&#39;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">&#39;Monto del Siniestro&#39;</span>)</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">&#39;Densidad&#39;</span>)</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="ss">f&#39;Distribuci√≥n de la cola (siniestros &gt; $</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&#39;</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>ax2.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(threshold, np.percentile(claims, <span class="fl">99.9</span>))</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/e968d8e9e65b4d64e41314682b592316dc42dd57.png" /></p>
</div>
</div>
<div class="cell markdown" id="1p_CYgvnbM_f">
<p>‚úÖ<em>Ajusto la distribuci√≥n de los valores extremos v√≠a PEAKS OVER
THRESHOLD</em></p>
</div>
<div class="cell code" data-execution_count="41"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="P_VZJcwhDZh4" data-outputId="28fb6cab-bd63-47f3-ba17-ad8f047487a9">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genpareto</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_gpd_excesses(x, u):</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Excesos (X &gt; u)</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.asarray(x)[x <span class="op">&gt;</span> u] <span class="op">-</span> u</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fijo loc=0</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    xi, loc, beta <span class="op">=</span> genpareto.fit(y, floc<span class="op">=</span><span class="fl">0.0</span>) <span class="co">#GPD ajustada debe empezar en 0 (el exceso m√≠nimo).</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xi, beta, y</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_pot(p, xi, beta, u, p_u):</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># v√°lido SOLO si p &gt; 1 - p_u (cuantil en la cola) --- recordar que solo podemos conocer el VaR si el percentil est√° dentro de la cola de dist.</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p <span class="op">&lt;=</span> <span class="dv">1</span> <span class="op">-</span> p_u:</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(xi) <span class="op">&lt;</span> <span class="fl">1e-8</span>:  <span class="co"># l√≠mite xi‚Üí0</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> u <span class="op">+</span> beta <span class="op">*</span> np.log(p_u<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>p))</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> u <span class="op">+</span> (beta<span class="op">/</span>xi) <span class="op">*</span> ((p_u<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">**</span>xi <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tvar_pot(p, xi, beta, u, p_u):</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> var_pot(p, xi, beta, u, p_u)</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(v):</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> xi <span class="op">&gt;=</span> <span class="dv">1</span>:</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.inf</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> u <span class="op">+</span> (beta <span class="op">+</span> (v <span class="op">-</span> u)) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> xi)</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> threshold</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>claims <span class="op">=</span> df_final.loc[df_final[<span class="st">&quot;SEVERITY&quot;</span>] <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;SEVERITY&quot;</span>].to_numpy()</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>xi, beta, excesses <span class="op">=</span> fit_gpd_excesses(claims, u)</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>p_u <span class="op">=</span> (claims <span class="op">&gt;</span> u).mean()</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;xi=</span><span class="sc">{</span>xi<span class="sc">:.4f}</span><span class="ss">, beta=</span><span class="sc">{</span>beta<span class="sc">:.2f}</span><span class="ss">, p_u=</span><span class="sc">{</span>p_u<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> [<span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>]:</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> var_pot(p, xi, beta, u, p_u)</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    es <span class="op">=</span> tvar_pot(p, xi, beta, u, p_u)</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span><span class="bu">int</span>(p<span class="op">*</span><span class="dv">1000</span>)<span class="op">/</span><span class="dv">10</span><span class="sc">:.1f}</span><span class="ss">%&quot;</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Nivel </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(v):</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;  (El cuant√≠l est√° por debajo del umbral: usar el modelo del cuerpo / emp√≠rico)&quot;</span>)</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  VaR  = </span><span class="sc">{</span>v<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  TVaR = </span><span class="sc">{</span>es<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">   (Œî=</span><span class="sc">{</span>es <span class="op">-</span> v<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss"> ‚â• 0)&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>xi=0.1073, beta=11896.06, p_u=0.0701

Nivel 95.0%
  VaR  = 13,504.06
  TVaR = 27,321.73   (Œî=13,817.67 ‚â• 0)

Nivel 99.0%
  VaR  = 35,174.00
  TVaR = 51,595.48   (Œî=16,421.48 ‚â• 0)

Nivel 99.5%
  VaR  = 45,722.82
  TVaR = 63,411.83   (Œî=17,689.00 ‚â• 0)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="42"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="NkPHw_rf-qLb" data-outputId="167e7b5f-9670-4483-cf9f-8be423bfae54">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>candidates <span class="op">=</span> [<span class="dv">7500</span>,<span class="dv">10000</span>, <span class="dv">11000</span>, <span class="dv">15000</span>]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>claims <span class="op">=</span> df_final.loc[df_final[<span class="st">&quot;SEVERITY&quot;</span>]<span class="op">&gt;</span><span class="dv">0</span>, <span class="st">&quot;SEVERITY&quot;</span>].to_numpy()</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u_ <span class="kw">in</span> candidates:</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    xi_, beta_, exc_ <span class="op">=</span> fit_gpd_excesses(claims, u_)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    p_u_ <span class="op">=</span> (claims <span class="op">&gt;</span> u_).mean()</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> [<span class="fl">0.99</span>, <span class="fl">0.995</span>]:</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        VaR_ <span class="op">=</span> var_pot(p, xi_, beta_, u_, p_u_)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        TVaR_ <span class="op">=</span> tvar_pot(p, xi_, beta_, u_, p_u_)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">&quot;u&quot;</span>: u_, <span class="st">&quot;p&quot;</span>: p, <span class="st">&quot;xi&quot;</span>: xi_, <span class="st">&quot;beta&quot;</span>: beta_, <span class="st">&quot;p_u&quot;</span>: p_u_, <span class="st">&quot;VaR&quot;</span>: VaR_, <span class="st">&quot;TVaR&quot;</span>: TVaR_})</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>sens <span class="op">=</span> pd.DataFrame(rows)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sens)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>       u      p        xi          beta       p_u           VaR          TVaR
0   7500  0.990  0.428564   6678.722344  0.101347  33962.795214  65496.903165
1   7500  0.995  0.428564   6678.722344  0.101347  48506.483394  90948.027229
2  10000  0.990  0.050960  13465.503048  0.063074  36000.818600  51585.524697
3  10000  0.995  0.050960  13465.503048  0.063074  46436.033140  62581.073657
4  11000  0.990  0.020782  14517.630995  0.056338  36554.157873  51922.232538
5  11000  0.995  0.020782  14517.630995  0.056338  47060.609954  62651.663076
6  15000  0.990  0.102419  12267.721465  0.045928  35241.017875  51218.158878
7  15000  0.995  0.102419  12267.721465  0.045928  45542.626434  62695.235598
</code></pre>
</div>
</div>
<div class="cell markdown" id="GHt5YikiHmSQ">
<p>üëâ La brecha TVaR‚àíVaR ~ 15K es bastante estable entre 99% y 99.5% ‚Üí
se√±al de cola ‚Äúno explosiva‚Äù.</p>
<p>üëâ Œæ ‚âà 0.021 &gt; 0 pero peque√±o ‚Üí cola ligera (m√°s pesada que
exponencial, mucho m√°s liviana que Pareto ‚Äúdura‚Äù).</p>
<p>üëâ El ajuste POT‚ÄìGPD con ùë¢=11,000 captura una cola moderadamente
pesada y produce VaR/TVaR razonables y crecientes. Esto valida la
necesidad del enfoque mixto: el ML ‚Äúpuro‚Äù comprim√≠a la cola; la GPD
corrige esa subestimaci√≥n.</p>
</div>
<div class="cell code" data-execution_count="43"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:535}"
id="zRdwhgaYHHNM" data-outputId="7b071832-e329-4e57-9e92-48e3d6168f35">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Visualizaci√≥n del ajuste GPD ---</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(excesses.<span class="bu">min</span>(), excesses.<span class="bu">max</span>(), <span class="dv">200</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>pdf_gpd <span class="op">=</span> genpareto.pdf(x, xi, loc<span class="op">=</span><span class="dv">0</span>, scale<span class="op">=</span>beta)  <span class="co"># loc=0 para excesos</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    excesses, bins<span class="op">=</span><span class="dv">50</span>, stat<span class="op">=</span><span class="st">&#39;density&#39;</span>, color<span class="op">=</span><span class="st">&#39;steelblue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="st">&#39;Datos (excesos)&#39;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, pdf_gpd, <span class="st">&#39;r-&#39;</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Ajuste GPD&#39;</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># --- T√≠tulo y ejes ---</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Ajuste de la cola con GPD (umbral = $</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Exceso sobre el umbral&#39;</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Densidad&#39;</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Texto con par√°metros ---</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>param_text <span class="op">=</span> (</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f&quot;Œæ (shape) = </span><span class="sc">{</span>xi<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f&quot;Œ≤ (scale) = </span><span class="sc">{</span>beta<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f&quot;p·µ§ = </span><span class="sc">{</span>p_u<span class="sc">:.4%}</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f&quot;n_excesos = </span><span class="sc">{</span><span class="bu">len</span>(excesses)<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>plt.text(</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.98</span>, <span class="fl">0.97</span>, param_text,</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>plt.gca().transAxes,</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    ha<span class="op">=</span><span class="st">&#39;right&#39;</span>, va<span class="op">=</span><span class="st">&#39;top&#39;</span>,</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">&#39;round&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/usr/local/lib/python3.12/dist-packages/IPython/core/pylabtools.py:151: UserWarning: Glyph 7524 (\N{LATIN SUBSCRIPT SMALL LETTER U}) missing from font(s) Liberation Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/fc3f8e2edc5cd284634a93e5e983d41babe5a4e5.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="44"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:524}"
id="1OQSiWk2HA-4" data-outputId="21432b2b-bb0f-4d87-a852-a9f59261c703">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> kstest</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === QQ-PLOT (excesos emp√≠ricos vs cuantiles te√≥ricos GPD) ===</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>ex <span class="op">=</span> np.asarray(excesses)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>ex_sorted <span class="op">=</span> np.sort(ex)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(ex_sorted)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades &quot;de gr√°fico&quot; (evitan 0 y 1): (i - 0.5)/n</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (np.arange(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>) <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">/</span> n</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuantiles te√≥ricos bajo GPD ajustada (loc=0 porque son excesos)</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>q_theo <span class="op">=</span> genpareto.ppf(p, c<span class="op">=</span>xi, scale<span class="op">=</span>beta, loc<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>q_theo, y<span class="op">=</span>ex_sorted, s<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>mx <span class="op">=</span> <span class="bu">max</span>(q_theo.<span class="bu">max</span>(), ex_sorted.<span class="bu">max</span>())</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, mx], [<span class="dv">0</span>, mx], <span class="st">&#39;r--&#39;</span>, lw<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">&#39;y = x&#39;</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Cuantiles te√≥ricos GPD&#39;</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Cuantiles emp√≠ricos (excesos)&#39;</span>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;QQ-plot GPD sobre excesos&#39;</span>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="co"># (Opcional) versi√≥n log-log para resaltar cola</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xscale(&#39;log&#39;); plt.yscale(&#39;log&#39;)</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="co"># === PP-PLOT (CDF te√≥rica vs CDF emp√≠rica) ===</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>F_theo <span class="op">=</span> genpareto.cdf(ex_sorted, c<span class="op">=</span>xi, scale<span class="op">=</span>beta, loc<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>F_emp  <span class="op">=</span> np.arange(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>) <span class="op">/</span> (n<span class="op">+</span><span class="dv">1</span>)  <span class="co"># escalado cl√°sico</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>F_theo, y<span class="op">=</span>F_emp, s<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>], <span class="st">&#39;r--&#39;</span>, lw<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">&#39;y = x&#39;</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;F_te√≥rica (GPD)&#39;</span>)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;F_emp√≠rica (excesos)&#39;</span>)</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;PP-plot GPD sobre excesos&#39;</span>)</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="co"># === KS test (goodness-of-fit) sobre excesos ===</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: los excesos provienen de GPD(xi, beta)</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>ks_stat, ks_p <span class="op">=</span> kstest(ex, <span class="kw">lambda</span> z: genpareto.cdf(z, c<span class="op">=</span>xi, scale<span class="op">=</span>beta, loc<span class="op">=</span><span class="fl">0.0</span>))</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;KS statistic: </span><span class="sc">{</span>ks_stat<span class="sc">:.4f}</span><span class="ss">  |  p-value: </span><span class="sc">{</span>ks_p<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/f49d92f716b59b493d4c992cf1e977925c38a85d.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>KS statistic: 0.0785  |  p-value: 0.1126
</code></pre>
</div>
</div>
<div class="cell markdown" id="buojiyF0Hpho">
<p>p-value = 0.4864 ‚Üí indica que no hay evidencia estad√≠sticamente
significativa para rechazar la hip√≥tesis nula (‚Äúlos excesos provienen de
una distribuci√≥n GPD con tus par√°metros estimados‚Äù).</p>
</div>
<div class="cell code" data-execution_count="45"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="qPgPBMyJ6wNq" data-outputId="c778c634-43e2-4b2f-d05d-20bc1e1045f8">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Emp√≠rico (XGB ‚Äúpuro‚Äù) sobre observados positivos ---</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>sev_pos <span class="op">=</span> np.asarray(y_test_sev)[np.asarray(y_test_sev) <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>sev_pos.sort()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_empirico(arr, p):</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(arr) <span class="op">==</span> <span class="dv">0</span>: <span class="cf">return</span> np.nan</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(np.quantile(arr, p, interpolation<span class="op">=</span><span class="st">&quot;linear&quot;</span>))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tvar_empirico(arr, p):</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(arr) <span class="op">==</span> <span class="dv">0</span>: <span class="cf">return</span> np.nan</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> var_empirico(arr, p)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    exc <span class="op">=</span> arr[arr <span class="op">&gt;=</span> v]</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(exc) <span class="op">==</span> <span class="dv">0</span>: <span class="cf">return</span> v</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(exc.mean())</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> [<span class="fl">0.99</span>, <span class="fl">0.995</span>, <span class="fl">0.999</span>]</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ps:</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    var_xgb <span class="op">=</span> var_empirico(sev_pos, p)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    tvar_xgb <span class="op">=</span> tvar_empirico(sev_pos, p)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p <span class="op">&lt;=</span> <span class="dv">1</span> <span class="op">-</span> p_u:</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># nivel de cola a√∫n no alcanzado: usar emp√≠rico (h√≠brido==xgb)</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>        var_h  <span class="op">=</span> var_xgb</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>        tvar_h <span class="op">=</span> tvar_xgb</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        var_h  <span class="op">=</span> var_pot(p, xi, beta, u, p_u)</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>        tvar_h <span class="op">=</span> tvar_pot(p, xi, beta, u, p_u)</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>    rows.append({</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;p&quot;</span>: p,</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;VaR_XGB&quot;</span>: var_xgb,</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;VaR_H√≠brido&quot;</span>: var_h,</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Œî_VaR_%&quot;</span>: <span class="fl">100.0</span> <span class="op">*</span> (var_h <span class="op">-</span> var_xgb) <span class="op">/</span> var_xgb <span class="cf">if</span> np.isfinite(var_xgb) <span class="kw">and</span> var_xgb<span class="op">&gt;</span><span class="dv">0</span> <span class="cf">else</span> np.nan,</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;TVaR_XGB&quot;</span>: tvar_xgb,</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;TVaR_H√≠brido&quot;</span>: tvar_h,</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Œî_TVaR_%&quot;</span>: <span class="fl">100.0</span> <span class="op">*</span> (tvar_h <span class="op">-</span> tvar_xgb) <span class="op">/</span> tvar_xgb <span class="cf">if</span> np.isfinite(tvar_xgb) <span class="kw">and</span> tvar_xgb<span class="op">&gt;</span><span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>tabla_var <span class="op">=</span> pd.DataFrame(rows)</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabla_var)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>       p    VaR_XGB   VaR_H√≠brido    Œî_VaR_%       TVaR_XGB  TVaR_H√≠brido  \
0  0.990  28872.720  35173.998594  21.824333   50436.571429  51595.477144   
1  0.995  36921.340  45722.823286  23.838472   64983.250000  63411.825766   
2  0.999  76364.348  73464.094021  -3.797916  107586.000000  94486.427513   

    Œî_TVaR_%  
0   2.297749  
1  -2.418199  
2 -12.175908  
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>/tmp/ipython-input-1899663306.py:21: DeprecationWarning: the `interpolation=` argument to quantile was renamed to `method=`, which has additional options.
Users of the modes &#39;nearest&#39;, &#39;lower&#39;, &#39;higher&#39;, or &#39;midpoint&#39; are encouraged to review the method they used. (Deprecated NumPy 1.22)
  var_xgb = var_empirico(sev_pos, p)
/tmp/ipython-input-1899663306.py:11: DeprecationWarning: the `interpolation=` argument to quantile was renamed to `method=`, which has additional options.
Users of the modes &#39;nearest&#39;, &#39;lower&#39;, &#39;higher&#39;, or &#39;midpoint&#39; are encouraged to review the method they used. (Deprecated NumPy 1.22)
  v = var_empirico(arr, p)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="46" id="IU65akpXbgWN">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_for_body(train_data, test_data, u):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filtrar SOLO cuerpo: 0 &lt; SEVERITY ‚â§ u</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    tr <span class="op">=</span> train_data</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    te <span class="op">=</span> test_data</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> tr.drop([<span class="st">&#39;FREQUENCY&#39;</span>,<span class="st">&#39;ID&#39;</span>,<span class="st">&#39;SEVERITY&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> tr[<span class="st">&#39;SEVERITY&#39;</span>]</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    X_test  <span class="op">=</span> te.drop([<span class="st">&#39;FREQUENCY&#39;</span>,<span class="st">&#39;ID&#39;</span>,<span class="st">&#39;SEVERITY&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    y_test  <span class="op">=</span> te[<span class="st">&#39;SEVERITY&#39;</span>]</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categ√≥ricas encode</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    cat_cols <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">&#39;object&#39;</span>,<span class="st">&#39;category&#39;</span>]).columns.tolist()</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> X_train.columns <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> cat_cols]</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cat_cols) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>        enc <span class="op">=</span> TargetEncoder(</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>            cols<span class="op">=</span>cat_cols, smoothing<span class="op">=</span><span class="dv">10</span>, min_samples_leaf<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>            handle_unknown<span class="op">=</span><span class="st">&#39;value&#39;</span>, handle_missing<span class="op">=</span><span class="st">&#39;value&#39;</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>        X_train_cat <span class="op">=</span> enc.fit_transform(X_train[cat_cols], y_train)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>        X_test_cat  <span class="op">=</span> enc.transform(X_test[cat_cols])</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>        enc <span class="op">=</span> <span class="va">None</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>        X_train_cat <span class="op">=</span> X_train[[]].copy()</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>        X_test_cat  <span class="op">=</span> X_test[[]].copy()</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    Xtr <span class="op">=</span> pd.concat([X_train[num_cols].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>                     X_train_cat.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    Xte <span class="op">=</span> pd.concat([X_test[num_cols].reset_index(drop<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>                     X_test_cat.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># target en log</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    ytr_log <span class="op">=</span> np.log(y_train.values)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    yte      <span class="op">=</span> y_test.values  <span class="co"># guardamos en escala original</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Xtr, Xte, ytr_log, yte, enc, cat_cols, num_cols</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="47" id="83SDbCZXMtdy">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_test_body(model, train_data, test_data, u):</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    Xtr, Xte, ytr_log, yte, enc, cat_cols, num_cols <span class="op">=</span> preprocess_for_body(train_data, test_data, u)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dentro de train_test_body, despu√©s de crear Xtr, ytr_log</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    ytr <span class="op">=</span> np.minimum(np.exp(ytr_log), u)  <span class="co"># escala original, truncado en u por definici√≥n del cuerpo</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># k controla cu√°nto ‚Äúempuj√°s‚Äù la zona alta (3‚Äì6 suele andar bien)</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (ytr <span class="op">/</span> u) <span class="op">**</span> k           <span class="co"># en [0,1]; cerca de u ‚Üí peso alto</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> np.clip(w, <span class="fl">0.1</span>, <span class="fl">10.0</span>)    <span class="co"># l√≠mites sanos para estabilidad</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    model_fit <span class="op">=</span> model.fit(Xtr, ytr_log, sample_weight<span class="op">=</span>w)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    ypred_log <span class="op">=</span> model_fit.predict(Xte)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Correcci√≥n de back-transform (lognormal): E[Y] ‚âà exp(mu + 0.5*sigma^2)</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> ytr_log <span class="op">-</span> model_fit.predict(Xtr)</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="op">=</span> <span class="bu">float</span>(np.mean(res<span class="op">**</span><span class="dv">2</span>)) <span class="co">#varianza</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    corr <span class="op">=</span> <span class="bu">float</span>(np.exp(<span class="fl">0.5</span> <span class="op">*</span> sigma2)) <span class="co">#factor de correcci√≥n del sesgo lognormal - corrige el sesgo introducido al volver de log a escala original.</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    ypred <span class="op">=</span> np.exp(ypred_log) <span class="op">*</span> corr</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># eso hace que si el modelo del cuerpo predice un valor mayor al umbral, rec√≥rtalo (‚Äòclip‚Äô) justo por debajo de u</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;&gt;&gt; m√©tricas &lt;&lt;&lt;</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> <span class="bu">float</span>(np.sqrt(mean_squared_error(yte, ypred)))</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>    mae  <span class="op">=</span> <span class="bu">float</span>(mean_absolute_error(yte, ypred))</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    bias <span class="op">=</span> <span class="bu">float</span>((np.mean(ypred) <span class="op">-</span> np.mean(yte)) <span class="op">/</span> <span class="bu">max</span>(np.mean(yte), <span class="fl">1e-12</span>))</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Cuerpo (‚â§ u=</span><span class="sc">{</span>u<span class="sc">:,}</span><span class="ss">) ‚Äî RMSE: </span><span class="sc">{</span>rmse<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss"> | MAE: </span><span class="sc">{</span>mae<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss"> | Bias: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>bias<span class="sc">:.2f}</span><span class="ss">%&quot;</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Var(log-residuos)‚âà</span><span class="sc">{</span>sigma2<span class="sc">:.4f}</span><span class="ss">  ‚áí  factor de correcci√≥n exp(0.5œÉ¬≤)=</span><span class="sc">{</span>corr<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model_fit, enc, cat_cols, num_cols, ypred, yte</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="48"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="kU8tpRg0M1gJ" data-outputId="36689a7c-f779-4dd3-f578-04db838de250">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Filtrar SOLO cuerpo: 0 &lt; SEVERITY ‚â§ u</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>body_train <span class="op">=</span> train_data[(train_data[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">&gt;</span> <span class="dv">0</span>)].copy()</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>body_test  <span class="op">=</span> test_data[(test_data[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">&gt;</span> <span class="dv">0</span>)].copy()</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>xgb_body_params <span class="op">=</span> {</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;objective&#39;</span>: <span class="st">&#39;reg:gamma&#39;</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;learning_rate&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_depth&#39;</span>: <span class="dv">6</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;n_estimators&#39;</span>: <span class="dv">600</span>,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;subsample&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;colsample_bytree&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;reg_lambda&#39;</span>: <span class="fl">1.0</span>,</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;random_state&#39;</span>: <span class="dv">42</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>xgb_body_model <span class="op">=</span> create_xgb_model(xgb_body_params)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Entreno con splits body_train / body_test y el umbral elegido</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>model_body, enc_body, cat_cols_body, num_cols_body, preds_body, y_test_body <span class="op">=</span> (</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    train_test_body(xgb_body_model, body_train, body_test, u)</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>preds_body <span class="op">=</span> preds_body[preds_body <span class="op">&lt;=</span> u]</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>preds_body.<span class="bu">max</span>()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Cuerpo (‚â§ u=9,407.77) ‚Äî RMSE: 7,327.04 | MAE: 3,683.19 | Bias: 5.90%
Var(log-residuos)‚âà0.2913  ‚áí  factor de correcci√≥n exp(0.5œÉ¬≤)=1.1568
</code></pre>
</div>
<div class="output execute_result" data-execution_count="48">
<pre><code>np.float32(9379.742)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="49"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="DW7mXN2OuQJr" data-outputId="3cb0543f-dded-4697-d225-f9cce8dc4272">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>simulated_excesses <span class="op">=</span> genpareto.rvs(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>xi,               <span class="co"># &#39;c&#39; es el par√°metro de forma xi en scipy</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="fl">0.0</span>,            <span class="co"># El exceso m√≠nimo es 0</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span>beta,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span> <span class="dv">230</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">8</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>simulated_tail_claims <span class="op">=</span> simulated_excesses <span class="op">+</span> u</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Predicci√≥n M√≠nima de la Cola v√≠a Peaks Over Threshold: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">min</span>(simulated_tail_claims)<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Predicci√≥n M√°xima de la Cola v√≠a Peaks Over Threshold: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(simulated_tail_claims)<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Predicci√≥n M√≠nima del modelo XGBOOST: </span><span class="sc">{</span>preds_body<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Predicci√≥n M√°xima del modelo XGBOOST: </span><span class="sc">{</span>preds_body<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Valor m√°ximo real: </span><span class="sc">{</span>df_final[<span class="st">&#39;SEVERITY&#39;</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
Predicci√≥n M√≠nima de la Cola v√≠a Peaks Over Threshold: 9,416.62
Predicci√≥n M√°xima de la Cola v√≠a Peaks Over Threshold: 106,207.95
Predicci√≥n M√≠nima del modelo XGBOOST: 1078.42
Predicci√≥n M√°xima del modelo XGBOOST: 9379.74
Valor m√°ximo real: 123247.00
</code></pre>
</div>
</div>
<div class="cell markdown" id="i8iWx0ZXc_En">
<p>VALOR ESPERADO DE SEVERIDAD MIXTA:</p>
</div>
<div class="cell markdown" id="31P0Hs1rc8wR">
<p><img
src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdsAAAA2CAYAAACP1zPcAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABiKSURBVHhe7dx7WBNX+gfwL4JYxHBVxAv4qAWkeMFiW6xWBUVwi1rF0q7VVl1Fxaq1orvq6haleK216Natq/Wu62W1uqxVUWDRKigXQQSU1UWhQkQuAUKAhLy/P35kHjIJkIQMoj2f58k/8545DDOT82bOZUyIiMAwDMMwjGA68DcwDMMwDGNcLNkyDMMwjMBYsmUYhmEYgbFkyzAMwzACY8mWYRiGYQTGki3DMAzDCIwlW4ZhGIYRGEu2DMMwDCMwlmwZhmEYRmAs2TIMwzCMwFiyZRiGYRiBsWTLMAzDMAJjyZZhGIZhBMaSLcMwDMMIjCVbhmEYhhEYS7YMwzAMIzCWbBmGYRhGYCZERPyNLxoRoaysDHV1dTA3N4etrS1MTEz4xfRWVVUFCwsLmJqa8kMGk0qlqKyshKmpKezs7IxatyGkUilMTU3x2muv8UMvvfb6v9XU1KC8vBwAYGNjY5Tjq6mpAQCj1PVbJpfLUVZWBqVSabRr81uhats6dOgAW1tbdOzYkV9Eb6/6fd1cPmiXT7bV1dUICQnBmjVrcPjwYdTW1vKLGGTHjh0oLi7mb26VGzduIDIyErNnzzZ63frKyMhAWFgY6urq+KFXQmlpKebNm4f8/Hx+6IWKi4tDcHAwIiMj8eDBA37YIHFxcYiLi+NvZvRUWFiIbdu2Yf78+ex86mnPnj2YP38+tm3bhsLCQn7YIK/6fd1cPhA82e7atQtWVlY6fWJiYrj97O3t8fXXX2Pp0qWQy+UIDg5WK2tjY4MNGzao/a0TJ06olRk3bhxKS0vVymgjk8kwe/ZsjeNZv3490HCDWFtbq/3tY8eOAQD8/PwQFRUFb29vXq1t69dff8WqVauwZMkSWFlZ8cMAgPT0dMTGxvI3vzScnJywcOFCrFy5EhUVFfxwq8XExGjcA019du3apbbvlClTEBUVhcGDB2Pnzp2wt7dXKx8QEKB2Lz569AgDBgzg4t27d8eNGzfU6mxKQkICevbsqVb/wIED8d///hcymQwffvihWkzX7wEAwY+9rTk7O2PLli1YsGABP/SbYWgbDAALFizAli1bYGtra/Q2uLKy0uh1vmjN5gNqA1VVVTRhwgR6/fXX6X//+59aTKFQ0MWLF8nNzY1SUlK48iEhIVRYWKhWViwWk5eXF9na2tKNGzfUYkRESqWSli9fTsuWLaOKigp+mDZs2KBRZ2MSiYR8fHzIysqKLl26pBbbv38/TZw4kfLy8tS2q7RUt5CUSiWtXLmSIiMj+SG6ffs2ffvttzRq1CgSiUS0fft2fpGXiuoaC/l/hISEaL3HlEol3blzh9zd3encuXPc9gsXLmgcj+o4RSIRhYeHq8VUYmJiaMyYMZSdnc0P0YULF+jChQv8zWpOnTpFIpGIJk2aRFKplNteXFxMY8eOpYMHD1JdXZ3aPrpo7bEbqrCwkJYvX07Tpk2j8vJyfrhVdDmfrzJ922Aiou3bt2ucs9a2wdquQ2vrbI+05QPBn2wBoLi4GLm5uXBxcUG3bt3UYqamphg5ciTefvttWFpaqsX4HBwcMGnSJCgUCsTHx/PDOH/+PABg8+bNEIlE/HCLrKys8PHHH4OIcPnyZaiGs1NSUhAXF4cjR46gT58+/N1euOzsbFy5cgWTJ0/mhwAAbm5uWLNmDSwsLPihl46JiQmCg4Nx9OhRPH78mB9utfLycuTk5KBHjx4a19rExARDhgyBr69vi/eXiYkJgoKCYGZmhvj4eI0n8fz8fOzduxeHDh3CgAED1GK6GjVqFFxdXZGamoq8vDygYYxy06ZNWLx4MT799FODxtna4tgbe/z4MRYtWoTQ0FDMmjULJ0+ehLW1Nb/YC/Hs2TMsWbIE1dXV/NBLpT23wcauk4hQVVXFtd/tRZsk29zcXIjFYnh7e3MXUyaTISMjgzshXbp0ga2tLW9PTQEBATA3N8fFixe5SSlo6Oo9c+YM1q1bZ1ADo+Lv74+ePXsiOjoaT548QUpKCiIiIhAZGQmrJrpnX7RLly6hb9++6NevHz+EYcOGYcKECXBwcOCHXlqurq6wtLREUlISP9Rq+fn5yM3NxZtvvsmdM4VCgYyMDMjlcgBA586d0bVrV96emjw8PODp6Yk7d+7g3r173HaxWIw//vGPWLFiBZycnNT20YeDgwOCgoIgkUhw7tw5yOVyrFq1Cq6urpg0aRK/uF6EPnYiQmZmJqZOnYo///nP+OKLL3DmzBkMHDjQKJMhjUWpVKK2trbdNdz6au9tsDHrrK+vx6FDhxAYGIj//Oc/qK+v5xd5Idok2d68eRNoaPhV7t+/j+PHj8PExASmpqYICAjQKZkNGDAAgwcPxt27d5GdnQ00PHlu3LgREREROtXRHGdnZwQGBuLp06fYvXs3tm7diqioKPTq1YtftF2oqanBL7/8Am9v73Y7w6+yshIxMTEoKCgAGibAxcbG4s6dOwZ9EWxsbDBo0CBcunTJ6I1gdnY2qqqq8Oabb8LMzAxoeLrZs2cPl2xHjhwJZ2dn3p6arKys4OfnB4VCwY2FVVRUYNGiRfjoo4/g5eXF30VvkydPhrW1NU6fPo21a9fCyckJ8+bNa3XCEurYiQjJyckIDAzEgQMHEBUVhcOHD8PFxYVftEUFBQWIiYlBZWWl2vaamhpIpVK1bW2tvr4eN2/e5O7x+vp63LlzB7GxsS/kKbm9t8HGrNPMzAyhoaE4deoUsrKyMGbMGJw+fZr7/hpCdf1u3ryp0WZVVFToVLfgyba6uhrJycmwtbVF165dUVRUhPv372PDhg0YOnQo0DANfNKkSToli8aNwJkzZ5Cfn4+NGzdi586drfqlrdK4C23//v0ICwszSr1CKS8vR1ZWFjw8PPihdkEmk+Grr75Ceno6fH198Ze//AXz58/H8+fP8c0332DZsmU63ah8/fv3R0FBgdEb1YSEBJiamsLFxQVFRUXIz8/H5s2b4eDggM6dOwMAJk2apHM359ixY2Fubo7o6Gg8ffoU69evx5QpU1r95Kni6uqKMWPGIDc3FxKJBKGhoa1OtCrGPPb6+npcunQJAQEB+Omnn3D48GFs27YNvXv35hfVyfnz57FhwwZcu3YN/v7+3ISZmpoazJkzB4sWLdJoFNvS0aNHER8fj6VLl2LRokWYNWsWEhMTkZKSgnHjxrXpjPqXoQ0Wos7OnTtj4cKFuHz5MmQyGcaMGYPDhw9DJpPxizZLLpdj9erVuHLlCsLDw7F27Voulpubi6FDh+LcuXNq+2gjeLJ99uwZ97Qwa9Ys+Pr6ws/PD8nJyRgyZAi/uE4mTJgACwsLnDt3DiEhIVi1ahXc3Nz4xQzWr18/9OnTB/X19VAqlfywwR49eoRRo0bhjTfe0Plz+vRpfjVqioqKUFtbCxsbG36oXUhMTISjoyMmTpyI2tpalJSUYM+ePQgODsayZctw9uxZXL9+nb9biwYMGID8/HxUVVXxQwYrLy/H3bt3QUQICwuDr68vRo8ejYMHD+K9997jF9eJh4cH3n77bdy/fx/z5s2Dk5MTpk+fbrSEaGZmhnfffRcAUFtba7R6YeRj37VrFxYvXozIyEhERETAzs6OX0RnxcXFuHjxIjZu3AgrKys8f/6c+9FVVFSE27dvY9iwYS9szXtJSQkSExPxhz/8Ad26dUNSUhLCw8OxYMECLFy4ECKRCFFRUfzdBPOytMFC1AkAFhYWmDlzJuLj42FhYQFfX19s2bJFo0ekKdevX4e9vT1CQkJARHj69Cn3Qy4tLQ0ymUyn4xQ82WZlZUEsFmPp0qXIyspCVlYWbt68iZEjR6J79+5Awy8HfbpWXFxc4OXlBbFYjLlz5xrcpaVNdXU1NmzYAEdHR9TV1eHkyZNG66rs168fEhISuPOgy2fatGn8ajR06tTJ6JOfampqUFRUpNOntLS0yXP09OlT+Pr64uHDh5BIJAgKCuKOtba2FlKpVG1MUB9yuZxbJK9NRUUFPv74Y/z+97/X6Qk4Ly8POTk5mDhxIjIzM5GVlYWMjAxMnjwZffv2BRqe0PRJ8JaWlvDz8wMRwdnZ2ahPnmgY0zp//jwcHR0RExNjtHW+MPKxL126FDExMfjxxx8xdepUZGZmNnnPtKSgoADvvPMOzMzMcOHCBYwcORI9evQAGp40ysrKDGoTJBKJxr1dXFwMmUwGsVisEWvqnioqKoKnpycUCgWys7Mxbtw4bj6FQqFATU0N7t+/r1eb11haWhoGDx6Mv/3tb/yQVi9LGyxEnY117NgR06ZNw/Xr1+Hh4YHAwEBs2rSpxaT78OFDTJgwATk5Obhz5w4CAwO5H3IJCQlwcXHR6elb8GSbnJwMABg+fDi3rbS0FB4eHtzT2I4dO/RapyeXyyGVSuHm5oYxY8bwwwaTy+VYt24dfHx8sHv3brWJUr81165dQ2RkpE6f7777TmPGqsonn3wCLy8vJCcno1evXmq/ALOzs6FQKHQa/9RG9baWpjx+/BgJCQm4desWnj59yg9rePDgAWQyGdeQo+HHV7du3eDo6AgAOHv2LI4fP87bs3mVlZXcLGpdJ3noIiUlBfv378exY8cwe/ZsbqKUMRnz2Pv06YO//vWv+P7773HgwAEEBgYiOTlZ76Q7dOhQfPbZZ8jJycG9e/fwu9/9jrteN2/eRPfu3TVmkrekuroae/bs0bi3d+zYgdTUVGzdulUj9s9//pNfDdDQIxASEoLHjx9DLBbDx8eHi4nFYuTl5aFbt24G/0D+5ZdfkJeXh4SEhGZ/bKq8LG2wEHVqoxqf/uqrr3DmzBkcOHCAX0TN3LlzMWjQIFy9ehW2trZ46623gEY9YW+88YZuw0pqC4GMrLm1XSr5+fk0d+5ckkgk3Lam1tmq5OTkkLOzM82ZM4eUSiU/3CRta59UlEol7dixg3bs2EFKpVJtreEPP/zAL66hubpVFAoFPXv2jAoLC3X+VFVV8atRk5aWRu7u7pSWlsYPqUlLSyMHBweN9aBtQSqV0sSJE2nGjBkkl8uJiEgul9OMGTPI2dmZcnJyiIhIJpPpvL7ywoUL5O7u3uw5VyqVlJGRQQ8fPuSHNCiVSlqwYEGTa/2o4b6cO3euxlprbetsVWQyGQUFBZGbmxsVFBTww03Sth6xsSdPntBHH31ET548ISKie/fuUe/evcnLy4vEYjG/uEEMPXZdlZSU0Jo1a2j8+PF08eJFUigU/CLN2r59u1rbojreoKAgkslkamVbOp9NKSwspJCQkBa/h9rs3LlTo+07ceIEiUQi2rdvHxER1dXVUWlpqV7tWHV1NV2/fl2nNaeGtsHUxDpbFUPb4Oaug6F16kOhUFB0dDT5+PjQ5s2bdTqH1Og8Nm7DVMerupaNacsHgj7ZqtZ2ubu7a116QkQ4cOAA3nrrLb1mm6Wnp6OsrAwjRowwuFurMSJCVFQUiouLua4y1a95c3Nz/OMf/2jyyU0ftbW1SE1NRWJios4f1QzeptjY2EChUGi8Gqw9UY0ZNZ7h++uvv+L27duYOnUq+vfvj7S0NGzZsgXBwcG4desWAOD06dOYM2eO1okulZWVMDMzQ4cOTd/CJiYmGDRokNYlUXwSiQRZWVno3bs3+vfvzw8DAKKjo2Ftba3Xk3hRURHS09MxcOBA2Nvb88MGyc/Px+LFi7F69Wqu+8rV1RV+fn548OABEhIS+LuokUgkkEgk/M0ahDj2xuzs7BAREYGzZ8/i0aNHes8azcnJUVs3qjpeb29vlJeXY+3atS/s1aUKhQJJSUlqx6dQKHDx4kW4urrC398f+fn5iIiIwLx587in5Fu3bmHy5MnNtjcWFhYYMWKETmtOX5Y2GALVqSKXy3H69Gn4+fnhyZMniI6OxsqVK3U6h2hob/Ly8tTasPT0dNTU1MDT0xOXL1/GiRMn+LupabqlMgLVWMGwYcO4mZwqpaWlWLFiBY4fPw5/f3+1WHOICHFxcbCwsICnpyc/rLfq6mps374d165dw+rVq9W6ylxdXeHh4YGMjAxkZmaq7WeIzp07w9/fHx988IHOn5YG3kUiEWxsbHSe3agtcQlNdR+ouryICIcPH4a1tTW+/PJLoGHs45NPPkFtbS13jElJSRg0aJDWiS5PnjyBq6urXg1Ec1TjtUOGDNGYvKO6R/70pz8hODhYr4ZA9b8bY2kWNaxNnTFjBkJDQzF48GAuZmZmhoCAAADAv/71ryYTlmoN8TvvvNPiS0GMeezN4c8a/fTTT1FWVsYvpqFjx46or68HEYGI8NNPP0EsFsPDwwOZmZlwdXWFubk5f7c28ezZM6SmpqKmpoa7n2/duoW4uDisW7cOvXr1wpUrVzB9+nSgYT0vAGRmZqJnz546J4GWvAxtMASqEw3f3d27d8PX1xdoeCfBwoULNc5FSzp06AAzMzPuWlZUVODIkSOwt7eHo6MjUlJSWj5utedcI9m7dy/17duXRCIRiUQisrOzI3d3d3J3dyc3NzeytrbmYsuXL9foMtDWjSyVSmnWrFnUvXt3tXpnzZql9qq65jR+tM/NzSVPT0+uLpFIRJ9//jnXlZWZmUlubm5qcXd3d0pMTOTV+v+0dRu0BVX3Z1hYGD9E1HAtXFxc1P4PJycnGj9+PD179oxfXBDh4eHUu3dv8vHxoZkzZ1JAQADNmDGDioqKiBr+B6lUSjExMeTv708SiYTKyspo7NixFBsby6+O64JuqutWH7GxsWrnx9ramtzc3Lj71c7Ojot98MEHVF1dza9Cazcy/zsgEolo2LBhlJmZqVauKfzutvXr16t9b5ycnNSGDlasWKH2t+zs7Cg0NJRqa2u5MkREBQUFNHz4cLKysmqyO6+1x95WUlNTyc3NjWbMmEGfffYZffPNN/T+++/T6NGj6cMPP1S7v/nnU1eGdiPfuHGD7O3tafz48TRhwgSaOXMmvfvuu3Tt2jWujFQqpbt379KIESMoLy+Pu6+1dUvqi38N9W2DSUs3sjHaYP51MEad2lRUVNDmzZvJx8eHoqOj9R6i4FMqlRQVFUVubm4UGhpK06dPp7///e/0+uuv0/vvv0/h4eFq51BbPhAk2baWtmRrDNpOgLEIWXdLTp06RaNHj6aysjJ+6IVTjXUEBQVRdXU1lZSUNNlwhYWFce/izcnJoffee4/y8/M1ElxeXh55eXlRUlKS2vYXRVuybS1+o2Rs+/fvp8uXL/M3v3Tq6upILBZz95RCoaDnz59rvBPa0PNpaLLdvn07Nx+hqqqKSkpKtCa0ffv2ceOAz58/J19fX7p9+3arEo2x8JOtMRh6HfRRWVlJYWFhFB8f3+oky1dVVUVisZi7v2QymdZrqy0fCNqNzLQNX19fmJubc7MO2xPVmNGIESNgYWEBOzu7Jt+/WlFRwc30S09Ph4ODAwoKCvDvf/9brVxiYiIGDhzILchn9KNQKJCbmwtXV1d+SDDGWkrG17FjRzg4OHD3lKmpKezt7Vs9c1pFJBIhICAAnTp14oeapFAokJqaCg8PD/Tu3RuWlpaws7PTOvwgkUi4ccAHDx6gvr4enTp1wt69e/lFGR116dIFW7duxejRo7UOQbWGpaUlHBwcuPvrtddea/La8rFk+wqws7PDF198gUOHDun9dhQhSaVSxMXFQSwWw9HRscVJOcOHD8eRI0fw/fff4+rVq5DL5YiOjtZYsnDy5EksXrzYaA3qb018fDxMTU31mujVWvosJfvhhx/0WvMpJEtLS0yZMoWbFNMSuVyOzMxMJCUloWvXrqiurm52noSnpydiYmKwb98+HD16FObm5jh27JjaciHm1WBCuv6EbENSqRRffvklwsPDufWNxhAREYG5c+catU4VIevWhWpGNQAsWbJEp19aQjt06JDa0/aoUaNafEmH6kUBlpaWkEqlMDU15SbnEBE2bdqELl264PPPP28X/yMA/Pzzz8jJycGyZcv4IYP9/PPPQMNbdYxJoVDg/PnzGDdunNEml70MhDqffBkZGWpPpT169MCSJUua7M1Bw1N/bW0trK2tuQlVzZVvK99++y0GDBhg1HPWVtfhRdOaD9Q6ldsJ1aC5u7t7qwfKGzt48CCVlJTwN7fK3r17yd3dvU0nHDWlrq6OvvvuO7p16xY/9Eq4evUq/fjjjxrjIy9abGwsN/lE24QuQyQmJjY5GY/RXWZmJnl7exv12vxWqNo2b29vo02Oe9Xv6+byQbt8smUYhmGYVwkbs2UYhmEYgbFkyzAMwzACY8mWYRiGYQTGki3DMAzDCIwlW4ZhGIYRGEu2DMMwDCMwlmwZhmEYRmAs2TIMwzCMwFiyZRiGYRiBsWTLMAzDMAJjyZZhGIZhBMaSLcMwDMMIjCVbhmEYhhEYS7YMwzAMIzCWbBmGYRhGYP8HBaHV9CQTcTEAAAAASUVORK5CYII="
alt="image.png" /></p>
</div>
<section id="valor-esperado-de-severidad" class="cell markdown"
id="GxHvyaL-iDSW">
<h1>VALOR ESPERADO DE SEVERIDAD</h1>
</section>
<div class="cell code" data-execution_count="50"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="QzQKaoUchVs7" data-outputId="5180ed46-81c9-43ea-d28e-70aa8d0ccc94">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>E_body <span class="op">=</span> np.mean(preds_body)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;valor esperado de severidad condicionado a que est√© dentro del grueso de la distribuci√≥n: </span><span class="sc">{</span>E_body<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>valor esperado de severidad condicionado a que est√© dentro del grueso de la distribuci√≥n: 4,338.54
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="51"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="zi9mVVOOhkVn" data-outputId="b1311ea4-0f95-4ada-bfb6-e857b3680226">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># media te√≥rica de la cola bajo una distribuci√≥n Generalized Pareto (GPD)</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tail_mean(u, xi, beta):</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> xi <span class="op">&gt;=</span> <span class="dv">1</span>:</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.inf</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> u <span class="op">+</span> beta<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span> xi)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>E_tail <span class="op">=</span> tail_mean(u, xi, beta)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;valor esperado de severidad condicionado a que est√© dentro de la cola de la distribuci√≥n: </span><span class="sc">{</span>E_tail<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>valor esperado de severidad condicionado a que est√© dentro de la cola de la distribuci√≥n: 22,733.23
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="52"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="YMuHPFfxgqj0" data-outputId="61a3ec87-517b-4145-f526-a542c2a9758d">
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>p_u</span></code></pre></div>
<div class="output execute_result" data-execution_count="52">
<pre><code>np.float64(0.07011635027556644)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="53"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="h6-NEJvmRwA4" data-outputId="19deb381-b80f-4af3-b021-cad9fb2f8750">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>E_X <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> p_u) <span class="op">*</span> E_body <span class="op">+</span> p_u <span class="op">*</span> E_tail</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;valor esperado de severidad descontextualizado: </span><span class="sc">{</span>E_X<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;valor esperado de severidad real: </span><span class="sc">{</span>df_final[df_final[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">!=</span> <span class="dv">0</span>][<span class="st">&#39;SEVERITY&#39;</span>]<span class="sc">.</span>mean()<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>valor esperado de severidad descontextualizado: 5,628.31
valor esperado de severidad real: 4,767.01
</code></pre>
</div>
</div>
<section id="valor-esperado-de-siniestralidad-frecuencia-x-severidad"
class="cell markdown" id="I84nZSjYzAMo">
<h1>VALOR ESPERADO DE SINIESTRALIDAD (FRECUENCIA X SEVERIDAD)</h1>
</section>
<div class="cell code" data-execution_count="54"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="53IKzMqtzFlr" data-outputId="7fadbb04-962d-449d-d56a-9c407231986f">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>E_S <span class="op">=</span> E_X <span class="op">*</span> valor_esp_frecuencia</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Prima Pura -  valor esperado de siniestralidad por p√≥liza: </span><span class="sc">{</span>E_S<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Prima Pura -  valor esperado de siniestralidad por p√≥liza: 1,971.82
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="55"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="X0q9c7cBtrMI" data-outputId="36281410-19e8-42e6-84fa-02971c5f3cff">
<div class="sourceCode" id="cb86"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>E_X</span></code></pre></div>
<div class="output execute_result" data-execution_count="55">
<pre><code>np.float64(5628.307504658313)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="56"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="gt1rRgJ13Ofa" data-outputId="2e9fc064-a121-445c-fc97-a4ef59779eb9">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Prima Pura -  valor esperado de siniestralidad por p√≥liza sin enfoque Peaks Over Threshold: </span><span class="sc">{</span>df_final[df_final[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">!=</span> <span class="dv">0</span>][<span class="st">&#39;SEVERITY&#39;</span>]<span class="sc">.</span>mean() <span class="op">*</span> valor_esp_frecuencia<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Prima Pura -  valor esperado de siniestralidad por p√≥liza sin enfoque Peaks Over Threshold: 1,670.07
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="57"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="576TErlA3T5x" data-outputId="33d9c1c8-7425-493e-a1f4-060f4f1216e0">
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>loading <span class="op">=</span> E_S<span class="op">/</span>(df_final[df_final[<span class="st">&#39;SEVERITY&#39;</span>] <span class="op">!=</span> <span class="dv">0</span>][<span class="st">&#39;SEVERITY&#39;</span>].mean() <span class="op">*</span> valor_esp_frecuencia)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Margen - recargo que se le puede hacer a la prima para contemplar este riesgo de valor extremo: </span><span class="sc">{</span>loading<span class="sc">:,</span><span class="fl">.5</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Margen - recargo que se le puede hacer a la prima para contemplar este riesgo de valor extremo: 0.18068
</code></pre>
</div>
</div>
<section id="medidas-de-riesgo" class="cell markdown" id="tagk9wgniHwh">
<h1>MEDIDAS DE RIESGO</h1>
</section>
<div class="cell code" data-execution_count="58"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="ea_FNLZGfJlY" data-outputId="13dd3e79-9ffa-41dd-81e7-21c9323f974f">
<div class="sourceCode" id="cb92"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Medidas de riesgo del modelo de distribuci√≥n h√≠brida con enfoque Peaks Over Threshold&quot;</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> [<span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>]:</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> var_pot(p, xi, beta, u, p_u)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    es <span class="op">=</span> tvar_pot(p, xi, beta, u, p_u)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span><span class="bu">int</span>(p<span class="op">*</span><span class="dv">1000</span>)<span class="op">/</span><span class="dv">10</span><span class="sc">:.1f}</span><span class="ss">%&quot;</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Nivel </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(v):</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;  (El cuant√≠l est√° por debajo del umbral: usar el modelo del cuerpo / emp√≠rico)&quot;</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  VaR  = </span><span class="sc">{</span>v<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  TVaR = </span><span class="sc">{</span>es<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">   (Œî=</span><span class="sc">{</span>es <span class="op">-</span> v<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss"> ‚â• 0)&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Medidas de riesgo del modelo de distribuci√≥n h√≠brida con enfoque Peaks Over Threshold

Nivel 95.0%
  VaR  = 13,504.06
  TVaR = 27,321.73   (Œî=13,817.67 ‚â• 0)

Nivel 99.0%
  VaR  = 35,174.00
  TVaR = 51,595.48   (Œî=16,421.48 ‚â• 0)

Nivel 99.5%
  VaR  = 45,722.82
  TVaR = 63,411.83   (Œî=17,689.00 ‚â• 0)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="59"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="1GkjSWY_ie4K" data-outputId="82d7b133-a319-4600-b106-63af304200b2">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Medidas de riesgo del modelo de Machine Learning XGBoost puro&quot;</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>VaR_dict <span class="op">=</span> {}</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>TVaR_dict <span class="op">=</span> {}</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> [<span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>]:</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    VaR_p <span class="op">=</span> np.percentile(preds_sev, <span class="dv">100</span> <span class="op">*</span> p)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    TVaR_p <span class="op">=</span> preds_sev[preds_sev <span class="op">&gt;=</span> VaR_p].mean()</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    VaR_dict[p] <span class="op">=</span> VaR_p</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    TVaR_dict[p] <span class="op">=</span> TVaR_p</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span><span class="bu">int</span>(p<span class="op">*</span><span class="dv">1000</span>)<span class="op">/</span><span class="dv">10</span><span class="sc">:.1f}</span><span class="ss">%&quot;</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Nivel </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(v):</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;  (El cuant√≠l est√° por debajo del umbral: usar el modelo del cuerpo / emp√≠rico)&quot;</span>)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  VaR  = </span><span class="sc">{</span>VaR_dict[p]<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;  TVaR = </span><span class="sc">{</span>TVaR_dict[p]<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Medidas de riesgo del modelo de Machine Learning XGBoost puro

Nivel 95.0%
  VaR  = 6,250.62
  TVaR = 6,905.61

Nivel 99.0%
  VaR  = 7,271.92
  TVaR = 7,990.50

Nivel 99.5%
  VaR  = 7,648.34
  TVaR = 8,410.23
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="60"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="iPS_RWQgu3uF" data-outputId="a38c603e-1ac9-4257-9a48-56e5aa7ff347">
<div class="sourceCode" id="cb96"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>u</span></code></pre></div>
<div class="output execute_result" data-execution_count="60">
<pre><code>9407.77</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="61"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:502}"
id="60dTs8MooKAn" data-outputId="240da3da-17cb-4813-e22f-88e3538547e2">
<div class="sourceCode" id="cb98"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>preds_hybrid_full <span class="op">=</span> np.concatenate([preds_sev, simulated_tail_claims])</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>preds_body_plot <span class="op">=</span> preds_hybrid_full[preds_hybrid_full  <span class="op">&lt;=</span> threshold]</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>preds_tail_plot <span class="op">=</span> preds_hybrid_full[preds_hybrid_full <span class="op">&gt;</span>  threshold]</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>real_body_plot <span class="op">=</span> claims[claims <span class="op">&lt;=</span> threshold]</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>real_tail_plot <span class="op">=</span> claims[claims <span class="op">&gt;</span>  threshold]</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>x_max <span class="op">=</span> np.percentile(np.concatenate([preds_hybrid_full, claims]), <span class="fl">99.9</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>bins_full <span class="op">=</span> np.linspace(<span class="dv">0</span>, x_max, <span class="dv">300</span>)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">7</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ====== Panel IZQ: H√çBRIDA (ML+EVT) ======</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>sns.histplot(preds_body_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;navy&#39;</span>,</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Grueso de la distribuci√≥n&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>sns.histplot(preds_tail_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;lightslategray&#39;</span>,</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Valores extremos con ajuste GPD&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">&#39;sienna&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f&#39;Umbral ($</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&#39;</span>)</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&#39;Monto de siniestro&#39;</span>)</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">&#39;Frecuencia&#39;</span>)</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;Distribuci√≥n H√≠brida (ML + EVT)&#39;</span>)</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>ax1.set_yscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>ax1.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>ax1.xaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>ax1.yaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="dv">0</span>, x_max)</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ====== Panel DER: REAL (SEVERITY &gt; 0) ======</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>sns.histplot(real_body_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;navy&#39;</span>,</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Grueso de la distribuci√≥n&#39;</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>sns.histplot(real_tail_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;indianred&#39;</span>,</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Valores extremos reales&#39;</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>ax2.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">&#39;sienna&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f&#39;Umbral ($</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&#39;</span>)</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">&#39;Monto de siniestro&#39;</span>)</span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&#39;Distribuci√≥n Real (condicional) con Umbral&#39;</span>)</span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>ax2.set_yscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>ax2.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(<span class="dv">0</span>, x_max)</span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/0dee0694580b0a6fdb3f05883d614731056e2ef2.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="62"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:502}"
id="0du6pKrAk-5p" data-outputId="88c53c38-3ffb-43fa-de9a-1e46fd73a298">
<div class="sourceCode" id="cb99"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>preds_hybrid_full <span class="op">=</span> np.concatenate([preds_sev, simulated_tail_claims])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>preds_body_plot <span class="op">=</span> preds_hybrid_full[preds_hybrid_full  <span class="op">&lt;=</span> threshold]</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>preds_tail_plot <span class="op">=</span> preds_hybrid_full[preds_hybrid_full <span class="op">&gt;</span>  threshold]</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>real_body_plot <span class="op">=</span> claims[claims <span class="op">&lt;=</span> threshold]</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>real_tail_plot <span class="op">=</span> claims[claims <span class="op">&gt;</span>  threshold]</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>x_max <span class="op">=</span> np.percentile(np.concatenate([preds_hybrid_full, claims]), <span class="fl">99.9</span>)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>bins_full <span class="op">=</span> np.linspace(<span class="dv">0</span>, x_max, <span class="dv">300</span>)</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">7</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ====== Panel IZQ: H√çBRIDA (ML+EVT) ======</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>sns.histplot(preds_body_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;navy&#39;</span>,</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Grueso de la distribuci√≥n&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>sns.histplot(preds_tail_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;lightslategray&#39;</span>,</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Valores extremos con ajuste GPD&#39;</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">&#39;sienna&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f&#39;Umbral ($</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&#39;</span>)</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&#39;Monto de siniestro&#39;</span>)</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">&#39;Frecuencia&#39;</span>)</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;Distribuci√≥n H√≠brida (ML + EVT)&#39;</span>)</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>ax1.set_yscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>ax1.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>ax1.xaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>ax1.yaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="dv">0</span>, x_max)</span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ====== Panel DER: REAL (SEVERITY &gt; 0) ======</span></span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>sns.histplot(real_body_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;navy&#39;</span>,</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Grueso de la distribuci√≥n&#39;</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>sns.histplot(real_tail_plot, bins<span class="op">=</span>bins_full, kde<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">&#39;indianred&#39;</span>,</span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">&#39;Valores extremos reales&#39;</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>ax2.axvline(x<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">&#39;sienna&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f&#39;Umbral ($</span><span class="sc">{</span>threshold<span class="sc">:,</span><span class="fl">.0</span><span class="er">f</span><span class="sc">}</span><span class="ss">)&#39;</span>)</span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">&#39;Monto de siniestro&#39;</span>)</span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&#39;Distribuci√≥n Real (condicional) con Umbral&#39;</span>)</span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>ax2.set_yscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a>ax2.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.set_major_formatter(FuncFormatter(human_format))</span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(<span class="dv">0</span>, x_max)</span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/0dee0694580b0a6fdb3f05883d614731056e2ef2.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="63"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="6CPpLdN4Gjtg" data-outputId="c9f1bb83-5450-4599-f2f5-deb7dbd43af5">
<div class="sourceCode" id="cb100"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> skew,kurtosis</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>skew_real <span class="op">=</span> skew(claims)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>skew_model <span class="op">=</span> skew(preds_hybrid_full)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>kurt_real <span class="op">=</span> kurtosis(claims)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>kurt_model <span class="op">=</span> kurtosis(preds_hybrid_full)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Asimetr√≠a real: </span><span class="sc">{</span>skew_real<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Asimetr√≠a modelo: </span><span class="sc">{</span>skew_model<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Curtosis real: </span><span class="sc">{</span>kurt_real<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Curtosis modelo: </span><span class="sc">{</span>kurt_model<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Asimetr√≠a real: 6.68
Asimetr√≠a modelo: 3.55
Curtosis real: 72.13
Curtosis modelo: 16.57
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="64"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:485}"
id="1Ct7GGHzG0cN" data-outputId="51351ab9-a6ad-4cb2-c845-1ca2adfb100a">
<div class="sourceCode" id="cb102"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(claims, label<span class="op">=</span><span class="st">&quot;Real&quot;</span>, log_scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(preds_hybrid_full, label<span class="op">=</span><span class="st">&quot;Modelo h√≠brido&quot;</span>, log_scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Comparaci√≥n de densidad (escala log)&quot;</span>)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Monto de Severidad&quot;</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_86127949df9d4931b4a06204378eda2d/cc1901571cf90ab9d301bcd15d22ec0bac83db70.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="65"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="48bSyT8rJRhr" data-outputId="65dddac4-a3d5-46e8-9e28-13730181b6e7">
<div class="sourceCode" id="cb103"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preds_body)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[1985.3383 4658.096  2820.0222 8888.238  2986.3362 3530.453  7321.095
 7227.8228 5614.1035 5667.116  3358.5854 1418.9677 6520.0493 9207.854
 3968.2444 3740.955  3801.131  7208.7407 3848.0217 2228.6853 4134.55
 5940.6562 2259.8108 8432.334  5293.458  6348.812  3607.1094 3195.7327
 2194.973  4463.017  2409.1238 5607.4414 3019.7307 2431.1643 3048.78
 4345.825  5874.431  6634.5654 4392.647  7658.356  3106.3425 5512.5625
 3369.1204 2071.3638 4614.373  4166.779  4037.876  1716.6626 4981.3774
 5020.408  7193.338  2379.0186 7363.389  2544.3003 2332.9663 4107.966
 3155.8003 6089.904  6144.4434 5862.5996 3439.0486 3284.1807 1635.6423
 3571.6633 8773.644  3225.8677 2490.8372 1768.2533 3279.7205 4186.4634
 5469.934  3593.1733 8797.581  3514.818  6231.04   3157.3132 2511.5115
 1600.5009 6000.762  2575.5886 9239.221  4216.0884 3151.4412 7542.76
 6300.289  2874.388  3412.4048 3415.9956 4738.812  5279.4272 2985.6316
 4011.8323 3683.7085 3270.6392 2308.2627 5233.519  1248.9879 2246.5623
 2646.7024 1650.0477 2244.7751 4781.561  2554.725  6746.574  3781.888
 2182.4722 6225.1724 2045.9873 5252.479  8917.037  4532.5864 4488.3794
 6688.3228 7690.6104 4713.1216 7090.1807 3862.5632 5273.5903 1689.3602
 2682.2153 7997.633  8934.215  7003.4893 4396.9766 7868.357  3862.077
 3874.021  5607.3022 5056.8174 7661.059  4323.6626 7042.55   3006.1038
 2234.7798 2971.3364 3612.0217 5187.441  5035.83   2914.3506 6296.4565
 2618.633  6013.4463 3710.7844 6429.6016 2514.1814 4376.5815 8637.678
 4519.4473 5478.925  4682.254  4098.929  5689.2915 4529.2373 3543.2295
 5192.484  2374.5881 3200.9543 4831.6216 4552.215  4440.431  3793.6165
 3543.1958 3171.7688 5011.0957 7400.87   2764.7107 8762.38   5904.3105
 4678.6025 5024.9927 4502.489  2398.2664 2632.4531 6129.472  2774.2454
 7269.209  4823.312  5752.2886 2705.2751 2658.481  2061.5654 5249.69
 4630.6885 5465.3354 2423.3206 1346.9878 5090.8525 2799.4995 3490.207
 2128.7285 2775.0234 3618.5486 6449.6646 9354.56   3429.634  3663.4277
 6658.805  5164.005  2615.8088 5164.0986 4300.379  7748.0312 4503.717
 1745.9651 3704.4163 3710.342  1587.9655 2764.8953 3714.757  3694.0405
 5646.9556 3868.5312 2125.8914 3482.5867 3782.6523 2389.1338 2324.2996
 3448.8276 2635.915  2326.4963 2545.3186 2776.2131 2505.2322 4389.603
 5132.68   3569.1404 2228.5376 4701.6284 2464.384  2841.3394 4014.4233
 2706.7168 5931.468  2076.6797 4240.1206 3606.1292 7717.067  4042.214
 4380.3945 1948.1641 3120.7302 3985.0903 7617.914  4813.9277 3322.7346
 4404.006  4982.8975 3697.047  5001.1694 2817.6016 2233.5706 5941.8286
 2790.2861 1976.0626 4246.4736 8520.552  4489.9634 3110.457  2599.3167
 4119.4995 2571.215  3853.0415 5001.8374 6357.331  3658.3613 4010.482
 4531.203  6825.671  4093.734  3298.9045 3576.333  5309.9453 3536.1172
 7548.307  4240.586  1572.1976 2040.9791 3029.525  2292.5374 5514.3184
 4936.2617 6400.633  6182.067  3622.474  3379.8464 3517.6616 4830.585
 3387.522  2341.147  2248.38   3331.7197 3199.3643 3392.6511 5641.1367
 6300.0303 4430.837  3362.5532 6088.835  3289.6772 3002.05   2178.2852
 8869.11   5844.969  3712.7986 4362.501  3024.6016 1434.6865 6750.9316
 4211.1787 5291.343  4420.096  3330.6807 8922.933  2407.2107 2646.097
 6567.7534 1505.4856 1458.6199 4656.222  2975.0042 4859.973  1662.1488
 8118.59   5529.0635 8707.691  3481.484  6495.584  3024.3965 5238.287
 4958.0874 6372.6216 3569.304  4102.1284 6673.1343 2345.6255 2708.2092
 6914.994  8078.5366 4055.2266 2002.4242 2566.8826 3238.532  5555.5547
 3458.8577 5701.143  3410.4297 3217.3804 3926.7246 5441.4375 2618.4407
 3528.6921 2585.1328 5565.4604 2573.7063 2337.2197 6910.8276 3557.7148
 1997.2413 3900.9707 5356.2593 7670.5474 6251.3066 7435.9893 8236.34
 2716.6094 3895.227  4101.0015 4369.0586 3073.039  7287.4507 1458.1082
 8376.302  3844.0676 3115.8381 3912.4343 4999.773  2001.2205 1078.4224
 6490.5186 3222.965  4394.7383 3213.9763 7531.274  5138.5913 3688.0989
 4990.64   4574.531  4526.8145 2533.4255 3336.462  6409.759  2363.0906
 8352.538  4087.796  2225.855  2748.6216 3178.6987 2634.3708 8269.088
 3664.095  5027.03   2686.2278 2342.9753 5284.53   3277.3457 1395.8418
 3684.703  2438.7961 5832.257  4863.228  1880.7805 6019.9126 7118.5215
 2801.5242 2169.9148 3968.5583 3346.8416 4136.1553 5730.6934 5322.976
 6590.8    3845.6736 5350.7344 3137.1902 2893.707  3602.0698 3257.0137
 7279.3994 5479.777  4384.0596 4278.796  3350.4438 3802.9443 3280.168
 2069.659  1985.8354 3562.4448 3163.9866 4369.85   5277.6655 3755.9153
 6718.7017 7069.8706 4361.6943 7298.9062 2822.6133 9379.742  2958.1328
 7429.589  4921.981  3699.7522 9376.809  7742.9346 4863.3584 1416.2745
 4897.633  3721.3203 2103.248  6348.5825 5133.2236 7223.7437 5807.137
 2468.5452 2668.8552 4415.3564 4321.7295 5385.126  5281.95   5297.033
 2024.2263 2137.5513 3183.8704 5047.0854 4551.0293 5565.471  3525.8232
 3574.8733 3527.4575 6116.4385 3313.5457 3799.7974 3950.1997 2261.089
 5077.427  1818.0736 3029.4624 5389.3237 4533.9653 3601.359  4877.2734
 5284.545  6212.22   2965.769  3751.2046 4260.7207 6245.039  2282.14
 3006.6611 3614.9614 5565.6406 7149.3955 5184.152  3131.2656 4037.3484
 3277.8303 2274.5752 4048.8152 3046.3198 2192.932  3512.5396 7600.454
 3337.73   3535.4023 2949.8613 3055.574  2662.8413 5319.723  3858.7744
 6051.0757 7285.9917 3360.4006 2434.5994 7351.208  2354.4724 3017.619
 5208.9756 2317.5288 8976.942  3482.4468 6153.5615 5581.0864 4177.9165
 2720.7957 2169.1619 2535.0942 3845.8645 5229.7666 7119.764  5384.941
 3435.1362 5078.6963 4009.5032 3285.6497 5235.5454 5410.6025 6956.075
 5161.267  2347.2703 3665.0173 6108.3076 4710.1514 2464.1648 3108.4077
 3988.6338 5425.23   7318.241  3634.9321 2789.3699 2148.643  2040.8915
 4152.102  3438.229  1988.4144 4772.4683 5507.344  5602.4653 2254.951
 2099.773  5246.547  3395.0933 3799.0188 7241.4487 2960.8125 3158.7134
 3612.0217 7660.6206 5984.692  2595.5415 2400.4592 6227.749  3555.0662
 4195.9883 2205.0447 5114.4546 5425.6646 4243.709  1456.2882 4477.7085
 4969.1504 3320.7488 7335.647  2402.7773 8797.465  6684.319  6626.617
 4849.321  2981.7302 5240.231  3158.5342 2893.6033 6901.192  3630.609
 3546.2146 7933.337  2845.6467 5979.8647 3995.1401 5264.9116 3259.8523
 4298.0464 4993.9395 7768.496  2605.715  3355.9116 4013.2827 4359.968
 3698.3765 2654.2605 2483.207  6381.964  6568.931  7804.154  3865.4707
 7695.3867 4294.142  1311.8724]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="66"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="dA2ZarxdANnl" data-outputId="c6c4f05c-81be-4a0c-b206-89c940fe6e5f">
<div class="sourceCode" id="cb105"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================== COTIZACI√ìN FINAL ‚Äî APLICACI√ìN PR√ÅCTICA =====================</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>nuevo_asegurado <span class="op">=</span> pd.DataFrame([{</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MVR_PTS&quot;</span>: <span class="dv">3</span>,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CLM_FREQ&quot;</span>: <span class="dv">0</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;OCCUPATION&quot;</span>: <span class="st">&quot;Blue Collar&quot;</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EDUCATION&quot;</span>: <span class="st">&quot;PhD&quot;</span>,</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;PARENT1&quot;</span>: <span class="st">&quot;No&quot;</span>,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;REVOKED&quot;</span>: <span class="st">&quot;No&quot;</span>,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MSTATUS&quot;</span>: <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;OLDCLAIM&quot;</span>: <span class="fl">0.0</span>,</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;HOMEKIDS&quot;</span>: <span class="dv">0</span>,</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;CAR_USE&quot;</span>: <span class="st">&quot;Private&quot;</span>,</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AGE&quot;</span>: <span class="fl">35.0</span>,</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;FREQUENCY&quot;</span>: <span class="dv">0</span>,</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;SEVERITY&quot;</span>: <span class="fl">0.0</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>}])</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Construir X con el mismo esquema que usaste al entrenar (num + cat codificadas)</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>cols_modelo <span class="op">=</span> <span class="bu">list</span>(num_cols_body) <span class="op">+</span> <span class="bu">list</span>(cat_cols_body)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>X_nuevo <span class="op">=</span> nuevo_asegurado[cols_modelo].copy()</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>Xn_num <span class="op">=</span> X_nuevo[num_cols_body].copy()</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>Xn_cat <span class="op">=</span> X_nuevo[cat_cols_body].copy()</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>Xn_cat_enc <span class="op">=</span> enc_body.transform(Xn_cat)  <span class="co"># &lt;&lt;&lt; usa tu encoder entrenado</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>X_nuevo_enc <span class="op">=</span> pd.concat([Xn_num.reset_index(drop<span class="op">=</span><span class="va">True</span>), Xn_cat_enc.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Predicci√≥n de FRECUENCIA (ya en escala final)</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>freq_pred <span class="op">=</span> <span class="bu">float</span>(model_freq.predict(X_nuevo_enc)[<span class="dv">0</span>])</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Predicci√≥n de SEVERIDAD (el modelo del cuerpo predice en LOG; aplicamos tu misma correcci√≥n)</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a><span class="co">#    a) armamos el X de entrenamiento con el mismo esquema (num + cat encod)</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>bt_num <span class="op">=</span> body_train[num_cols_body].copy()</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>bt_cat <span class="op">=</span> body_train[cat_cols_body].copy()</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>bt_cat_enc <span class="op">=</span> enc_body.transform(bt_cat)</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>Xtr_enc_body <span class="op">=</span> pd.concat([bt_num.reset_index(drop<span class="op">=</span><span class="va">True</span>), bt_cat_enc.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a><span class="co">#    b) residuales en log para estimar sigma^2 (como en tu train_test_body)</span></span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>ytr_log_true <span class="op">=</span> np.log(body_train[<span class="st">&quot;SEVERITY&quot;</span>].clip(lower<span class="op">=</span><span class="fl">1e-6</span>))</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>res_log <span class="op">=</span> ytr_log_true.values <span class="op">-</span> model_body.predict(Xtr_enc_body)</span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> <span class="bu">float</span>(np.mean(res_log<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> <span class="bu">float</span>(np.exp(<span class="fl">0.5</span> <span class="op">*</span> sigma2))  <span class="co"># correcci√≥n lognormal de tu funci√≥n</span></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a><span class="co">#    c) predicci√≥n final en escala original (y clip opcional al umbral u del cuerpo)</span></span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>sev_pred_log <span class="op">=</span> <span class="bu">float</span>(model_body.predict(X_nuevo_enc)[<span class="dv">0</span>])</span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a>sev_pred <span class="op">=</span> <span class="bu">float</span>(np.exp(sev_pred_log) <span class="op">*</span> corr)</span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>sev_pred <span class="op">=</span> <span class="bu">float</span>(np.minimum(sev_pred, u))  <span class="co"># respeta el dominio del cuerpo (opcional, no cambia el modelo)</span></span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Primas</span></span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a>prima_pura <span class="op">=</span> freq_pred <span class="op">*</span> sev_pred</span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a>prima_con_loading <span class="op">=</span> prima_pura <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> loading)</span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Resultado final (inputs + outputs)</span></span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a>cotizacion <span class="op">=</span> nuevo_asegurado.copy()</span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>cotizacion[<span class="st">&quot;freq_esperada&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(freq_pred, <span class="dv">5</span>)</span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a>cotizacion[<span class="st">&quot;sev_esperada&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(sev_pred, <span class="dv">2</span>)</span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>cotizacion[<span class="st">&quot;prima_pura&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(prima_pura, <span class="dv">2</span>)</span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a>cotizacion[<span class="st">&quot;prima_con_loading&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(prima_con_loading, <span class="dv">2</span>)</span>
<span id="cb105-58"><a href="#cb105-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-59"><a href="#cb105-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=== Cotizaci√≥n estimada para el asegurado ===&quot;</span>)</span>
<span id="cb105-60"><a href="#cb105-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cotizacion[[</span>
<span id="cb105-61"><a href="#cb105-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MVR_PTS&quot;</span>,<span class="st">&quot;OCCUPATION&quot;</span>,<span class="st">&quot;EDUCATION&quot;</span>,<span class="st">&quot;AGE&quot;</span>,<span class="st">&quot;CAR_USE&quot;</span>,</span>
<span id="cb105-62"><a href="#cb105-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;freq_esperada&quot;</span>,<span class="st">&quot;sev_esperada&quot;</span>,<span class="st">&quot;prima_pura&quot;</span>,<span class="st">&quot;prima_con_loading&quot;</span></span>
<span id="cb105-63"><a href="#cb105-63" aria-hidden="true" tabindex="-1"></a>]])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>=== Cotizaci√≥n estimada para el asegurado ===
   MVR_PTS   OCCUPATION EDUCATION   AGE  CAR_USE  freq_esperada  sev_esperada  \
0        3  Blue Collar       PhD  35.0  Private        1.01409        3081.5   

   prima_pura  prima_con_loading  
0     3124.91            3689.51  
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="67"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:224}"
id="W0IUmcC0HUIN" data-outputId="e0c848a5-9688-446d-baaa-3d9c6a42a2af">
<div class="sourceCode" id="cb107"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar registros reales con las mismas caracter√≠sticas</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>comparables <span class="op">=</span> df_final[</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    (df_final[<span class="st">&quot;OCCUPATION&quot;</span>] <span class="op">==</span> <span class="st">&quot;Blue Collar&quot;</span>) <span class="op">&amp;</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#(df_final[&quot;EDUCATION&quot;] == &quot;High School&quot;) &amp;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    (df_final[<span class="st">&quot;AGE&quot;</span>] <span class="op">==</span> <span class="dv">35</span>) <span class="op">&amp;</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    (df_final[<span class="st">&quot;MVR_PTS&quot;</span>] <span class="op">==</span> <span class="dv">3</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar coincidencias</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Se encontraron </span><span class="sc">{</span><span class="bu">len</span>(comparables)<span class="sc">}</span><span class="ss"> registros similares en df_final:&quot;</span>)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>display(comparables.head())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Se encontraron 9 registros similares en df_final:
</code></pre>
</div>
<div class="output display_data">

  <div id="df-acfffa59-e14c-4c83-8555-598d1ae64e70" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MVR_PTS</th>
      <th>CLM_FREQ</th>
      <th>OCCUPATION</th>
      <th>EDUCATION</th>
      <th>PARENT1</th>
      <th>REVOKED</th>
      <th>MSTATUS</th>
      <th>OLDCLAIM</th>
      <th>HOMEKIDS</th>
      <th>CAR_USE</th>
      <th>AGE</th>
      <th>FREQUENCY</th>
      <th>SEVERITY</th>
      <th>ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1351</th>
      <td>3</td>
      <td>1</td>
      <td>Blue Collar</td>
      <td>Bachelors</td>
      <td>Yes</td>
      <td>No</td>
      <td>No</td>
      <td>4645.0</td>
      <td>4</td>
      <td>Private</td>
      <td>35.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>130470336</td>
    </tr>
    <tr>
      <th>3291</th>
      <td>3</td>
      <td>2</td>
      <td>Blue Collar</td>
      <td>High School</td>
      <td>No</td>
      <td>No</td>
      <td>No</td>
      <td>5347.0</td>
      <td>0</td>
      <td>Commercial</td>
      <td>35.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>316455627</td>
    </tr>
    <tr>
      <th>3416</th>
      <td>3</td>
      <td>2</td>
      <td>Blue Collar</td>
      <td>&lt;High School</td>
      <td>No</td>
      <td>No</td>
      <td>Yes</td>
      <td>13272.0</td>
      <td>0</td>
      <td>Commercial</td>
      <td>35.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>327103894</td>
    </tr>
    <tr>
      <th>4548</th>
      <td>3</td>
      <td>2</td>
      <td>Blue Collar</td>
      <td>Bachelors</td>
      <td>No</td>
      <td>Yes</td>
      <td>No</td>
      <td>31039.0</td>
      <td>0</td>
      <td>Commercial</td>
      <td>35.0</td>
      <td>1</td>
      <td>3840.0</td>
      <td>441024113</td>
    </tr>
    <tr>
      <th>4765</th>
      <td>3</td>
      <td>0</td>
      <td>Blue Collar</td>
      <td>High School</td>
      <td>No</td>
      <td>No</td>
      <td>Yes</td>
      <td>0.0</td>
      <td>2</td>
      <td>Commercial</td>
      <td>35.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>462775314</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-acfffa59-e14c-4c83-8555-598d1ae64e70')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-acfffa59-e14c-4c83-8555-598d1ae64e70 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-acfffa59-e14c-4c83-8555-598d1ae64e70');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-f9948941-4dcf-4ec4-a8ab-ee002f609b0a">
      <button class="colab-df-quickchart" onclick="quickchart('df-f9948941-4dcf-4ec4-a8ab-ee002f609b0a')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-f9948941-4dcf-4ec4-a8ab-ee002f609b0a button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="68"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="NfUmpqZdNr-o" data-outputId="fe99a98d-aff3-4005-9022-7181a438deec">
<div class="sourceCode" id="cb109"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install ipywidgets</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Requirement already satisfied: ipywidgets in /usr/local/lib/python3.12/dist-packages (7.7.1)
Requirement already satisfied: ipykernel&gt;=4.5.1 in /usr/local/lib/python3.12/dist-packages (from ipywidgets) (6.17.1)
Requirement already satisfied: ipython-genutils~=0.2.0 in /usr/local/lib/python3.12/dist-packages (from ipywidgets) (0.2.0)
Requirement already satisfied: traitlets&gt;=4.3.1 in /usr/local/lib/python3.12/dist-packages (from ipywidgets) (5.7.1)
Requirement already satisfied: widgetsnbextension~=3.6.0 in /usr/local/lib/python3.12/dist-packages (from ipywidgets) (3.6.10)
Requirement already satisfied: ipython&gt;=4.0.0 in /usr/local/lib/python3.12/dist-packages (from ipywidgets) (7.34.0)
Requirement already satisfied: jupyterlab-widgets&gt;=1.0.0 in /usr/local/lib/python3.12/dist-packages (from ipywidgets) (3.0.15)
Requirement already satisfied: debugpy&gt;=1.0 in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (1.8.15)
Requirement already satisfied: jupyter-client&gt;=6.1.12 in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (7.4.9)
Requirement already satisfied: matplotlib-inline&gt;=0.1 in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (0.2.1)
Requirement already satisfied: nest-asyncio in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (1.6.0)
Requirement already satisfied: packaging in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (25.0)
Requirement already satisfied: psutil in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (5.9.5)
Requirement already satisfied: pyzmq&gt;=17 in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (26.2.1)
Requirement already satisfied: tornado&gt;=6.1 in /usr/local/lib/python3.12/dist-packages (from ipykernel&gt;=4.5.1-&gt;ipywidgets) (6.5.1)
Requirement already satisfied: setuptools&gt;=18.5 in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (75.2.0)
Collecting jedi&gt;=0.16 (from ipython&gt;=4.0.0-&gt;ipywidgets)
  Downloading jedi-0.19.2-py2.py3-none-any.whl.metadata (22 kB)
Requirement already satisfied: decorator in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (4.4.2)
Requirement already satisfied: pickleshare in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (0.7.5)
Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0 in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (3.0.52)
Requirement already satisfied: pygments in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (2.19.2)
Requirement already satisfied: backcall in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (0.2.0)
Requirement already satisfied: pexpect&gt;4.3 in /usr/local/lib/python3.12/dist-packages (from ipython&gt;=4.0.0-&gt;ipywidgets) (4.9.0)
Requirement already satisfied: notebook&gt;=4.4.1 in /usr/local/lib/python3.12/dist-packages (from widgetsnbextension~=3.6.0-&gt;ipywidgets) (6.5.7)
Requirement already satisfied: parso&lt;0.9.0,&gt;=0.8.4 in /usr/local/lib/python3.12/dist-packages (from jedi&gt;=0.16-&gt;ipython&gt;=4.0.0-&gt;ipywidgets) (0.8.5)
Requirement already satisfied: entrypoints in /usr/local/lib/python3.12/dist-packages (from jupyter-client&gt;=6.1.12-&gt;ipykernel&gt;=4.5.1-&gt;ipywidgets) (0.4)
Requirement already satisfied: jupyter-core&gt;=4.9.2 in /usr/local/lib/python3.12/dist-packages (from jupyter-client&gt;=6.1.12-&gt;ipykernel&gt;=4.5.1-&gt;ipywidgets) (5.9.1)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.12/dist-packages (from jupyter-client&gt;=6.1.12-&gt;ipykernel&gt;=4.5.1-&gt;ipywidgets) (2.9.0.post0)
Requirement already satisfied: jinja2 in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (3.1.6)
Requirement already satisfied: argon2-cffi in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (25.1.0)
Requirement already satisfied: nbformat in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (5.10.4)
Requirement already satisfied: nbconvert&gt;=5 in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (7.16.6)
Requirement already satisfied: Send2Trash&gt;=1.8.0 in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.8.3)
Requirement already satisfied: terminado&gt;=0.8.3 in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.18.1)
Requirement already satisfied: prometheus-client in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.23.1)
Requirement already satisfied: nbclassic&gt;=0.4.7 in /usr/local/lib/python3.12/dist-packages (from notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.3.3)
Requirement already satisfied: ptyprocess&gt;=0.5 in /usr/local/lib/python3.12/dist-packages (from pexpect&gt;4.3-&gt;ipython&gt;=4.0.0-&gt;ipywidgets) (0.7.0)
Requirement already satisfied: wcwidth in /usr/local/lib/python3.12/dist-packages (from prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0-&gt;ipython&gt;=4.0.0-&gt;ipywidgets) (0.2.14)
Requirement already satisfied: platformdirs&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from jupyter-core&gt;=4.9.2-&gt;jupyter-client&gt;=6.1.12-&gt;ipykernel&gt;=4.5.1-&gt;ipywidgets) (4.5.0)
Requirement already satisfied: notebook-shim&gt;=0.2.3 in /usr/local/lib/python3.12/dist-packages (from nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.2.4)
Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (4.13.5)
Requirement already satisfied: bleach!=5.0.0 in /usr/local/lib/python3.12/dist-packages (from bleach[css]!=5.0.0-&gt;nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (6.3.0)
Requirement already satisfied: defusedxml in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.7.1)
Requirement already satisfied: jupyterlab-pygments in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.3.0)
Requirement already satisfied: markupsafe&gt;=2.0 in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (3.0.3)
Requirement already satisfied: mistune&lt;4,&gt;=2.0.3 in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (3.1.4)
Requirement already satisfied: nbclient&gt;=0.5.0 in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.10.2)
Requirement already satisfied: pandocfilters&gt;=1.4.1 in /usr/local/lib/python3.12/dist-packages (from nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.5.1)
Requirement already satisfied: fastjsonschema&gt;=2.15 in /usr/local/lib/python3.12/dist-packages (from nbformat-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2.21.2)
Requirement already satisfied: jsonschema&gt;=2.6 in /usr/local/lib/python3.12/dist-packages (from nbformat-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (4.25.1)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil&gt;=2.8.2-&gt;jupyter-client&gt;=6.1.12-&gt;ipykernel&gt;=4.5.1-&gt;ipywidgets) (1.17.0)
Requirement already satisfied: argon2-cffi-bindings in /usr/local/lib/python3.12/dist-packages (from argon2-cffi-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (25.1.0)
Requirement already satisfied: webencodings in /usr/local/lib/python3.12/dist-packages (from bleach!=5.0.0-&gt;bleach[css]!=5.0.0-&gt;nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.5.1)
Requirement already satisfied: tinycss2&lt;1.5,&gt;=1.1.0 in /usr/local/lib/python3.12/dist-packages (from bleach[css]!=5.0.0-&gt;nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.4.0)
Requirement already satisfied: attrs&gt;=22.2.0 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (25.4.0)
Requirement already satisfied: jsonschema-specifications&gt;=2023.03.6 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2025.9.1)
Requirement already satisfied: referencing&gt;=0.28.4 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.37.0)
Requirement already satisfied: rpds-py&gt;=0.7.1 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.28.0)
Requirement already satisfied: jupyter-server&lt;3,&gt;=1.8 in /usr/local/lib/python3.12/dist-packages (from notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2.14.0)
Requirement already satisfied: cffi&gt;=1.0.1 in /usr/local/lib/python3.12/dist-packages (from argon2-cffi-bindings-&gt;argon2-cffi-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2.0.0)
Requirement already satisfied: soupsieve&gt;1.2 in /usr/local/lib/python3.12/dist-packages (from beautifulsoup4-&gt;nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2.8)
Requirement already satisfied: typing-extensions&gt;=4.0.0 in /usr/local/lib/python3.12/dist-packages (from beautifulsoup4-&gt;nbconvert&gt;=5-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (4.15.0)
Requirement already satisfied: pycparser in /usr/local/lib/python3.12/dist-packages (from cffi&gt;=1.0.1-&gt;argon2-cffi-bindings-&gt;argon2-cffi-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2.23)
Requirement already satisfied: anyio&gt;=3.1.0 in /usr/local/lib/python3.12/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (4.11.0)
Requirement already satisfied: jupyter-events&gt;=0.9.0 in /usr/local/lib/python3.12/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.12.0)
Requirement already satisfied: jupyter-server-terminals&gt;=0.4.4 in /usr/local/lib/python3.12/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.5.3)
Requirement already satisfied: overrides&gt;=5.0 in /usr/local/lib/python3.12/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (7.7.0)
Requirement already satisfied: websocket-client&gt;=1.7 in /usr/local/lib/python3.12/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.9.0)
Requirement already satisfied: idna&gt;=2.8 in /usr/local/lib/python3.12/dist-packages (from anyio&gt;=3.1.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (3.11)
Requirement already satisfied: sniffio&gt;=1.1 in /usr/local/lib/python3.12/dist-packages (from anyio&gt;=3.1.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.3.1)
Requirement already satisfied: python-json-logger&gt;=2.0.4 in /usr/local/lib/python3.12/dist-packages (from jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (4.0.0)
Requirement already satisfied: pyyaml&gt;=5.3 in /usr/local/lib/python3.12/dist-packages (from jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (6.0.3)
Requirement already satisfied: rfc3339-validator in /usr/local/lib/python3.12/dist-packages (from jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.1.4)
Requirement already satisfied: rfc3986-validator&gt;=0.1.1 in /usr/local/lib/python3.12/dist-packages (from jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (0.1.1)
Requirement already satisfied: fqdn in /usr/local/lib/python3.12/dist-packages (from jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.5.1)
Requirement already satisfied: isoduration in /usr/local/lib/python3.12/dist-packages (from jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (20.11.0)
Requirement already satisfied: jsonpointer&gt;1.13 in /usr/local/lib/python3.12/dist-packages (from jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (3.0.0)
Requirement already satisfied: rfc3987-syntax&gt;=1.1.0 in /usr/local/lib/python3.12/dist-packages (from jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.1.0)
Requirement already satisfied: uri-template in /usr/local/lib/python3.12/dist-packages (from jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.3.0)
Requirement already satisfied: webcolors&gt;=24.6.0 in /usr/local/lib/python3.12/dist-packages (from jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (24.11.1)
Requirement already satisfied: lark&gt;=1.2.2 in /usr/local/lib/python3.12/dist-packages (from rfc3987-syntax&gt;=1.1.0-&gt;jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.3.1)
Requirement already satisfied: arrow&gt;=0.15.0 in /usr/local/lib/python3.12/dist-packages (from isoduration-&gt;jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (1.4.0)
Requirement already satisfied: tzdata in /usr/local/lib/python3.12/dist-packages (from arrow&gt;=0.15.0-&gt;isoduration-&gt;jsonschema[format-nongpl]&gt;=4.18.0-&gt;jupyter-events&gt;=0.9.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook&gt;=4.4.1-&gt;widgetsnbextension~=3.6.0-&gt;ipywidgets) (2025.2)
Downloading jedi-0.19.2-py2.py3-none-any.whl (1.6 MB)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 1.6/1.6 MB 21.2 MB/s eta 0:00:00
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="69"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:241,&quot;referenced_widgets&quot;:[&quot;a372091bc81f47a7a1c49b32c622c8c1&quot;,&quot;4260c087d29b4e40ae1a25f2e47fe14d&quot;,&quot;5bdfac224faa41cb9188f5e3683463fc&quot;,&quot;9f6476ee75794ae4b76aca0642fb6826&quot;,&quot;2b52566c32f949c9b30a565147ea6681&quot;,&quot;d7364775a1d347cbabc19ca761a47833&quot;,&quot;0d6d9734b27d4d9e95072a527d854cdb&quot;,&quot;50c4980cf00a453885f51ba5016794bb&quot;,&quot;a7b86b7d45e0485095ff03da494375e0&quot;,&quot;52dbc75ec267466da9570cdb2ead03f5&quot;,&quot;209d90ac41d84eeb99d5b39c4d224ab3&quot;,&quot;e564279c31484cf4bd16cad8fd1569bb&quot;,&quot;d886dc119daa449ba99532757c101219&quot;,&quot;dfc99f32f2e641e183c10da206f9133c&quot;,&quot;c4ae0ffe5b3d48feaa6b802a5016f6b6&quot;,&quot;33665445087f4722887526565ce06052&quot;,&quot;def725e3e8d44d78a8294ed30ec98e1e&quot;,&quot;ec72c139a7d640b298ddeaa8b06fbd17&quot;,&quot;396f2a6518fd4ff2881d994ef52c8adf&quot;,&quot;99304a42258b4afc8615d2bc01018018&quot;,&quot;08dcd7d34ec44a3da89fc65f30718e10&quot;,&quot;92b36916954642c1a6d34d5cada4a7da&quot;,&quot;038de66c1db04e7d8cc03aaad4b05087&quot;,&quot;48c54ac4dcad4d5e9287056fbdc36f4c&quot;,&quot;624844400e4b4c72a4ad41ec0e9436ef&quot;,&quot;2689ce953fe3419dbfb994263d6846d7&quot;,&quot;2a47cf3b68a04253ac12e6135b8f0ed8&quot;,&quot;9a69351ce1544c7bb0ec915024181adf&quot;,&quot;d4624ad84e6e408e83fa95fdf68e4270&quot;,&quot;f501abf7a8b64491846affd2347fd6a1&quot;,&quot;13995aa02b1641a492f533eaec233674&quot;,&quot;eb2ebfe71dbe4dcf8f5b5a6720b676b6&quot;,&quot;6b204db02db14a4daefaf4da0b75fb40&quot;,&quot;4f7e90dd1f2d4f57978a2238f82b137b&quot;,&quot;3f54f8579fb244b8a28d48a6c2dc4fe9&quot;,&quot;b52421de92f8491d94a10e57ff707bad&quot;,&quot;3fe907cb21014c11ae46b380c6a6d90d&quot;,&quot;95df9a42ce574088a2abd38404e64666&quot;,&quot;1975488628564f8db043ba0725a9850e&quot;,&quot;ededf074c9614f9b94e58b489ebf193c&quot;,&quot;b0f701f569c64f43b6946649dea96ef8&quot;,&quot;b11ce19970d84541b323ac37fe93420f&quot;,&quot;fb0b9bcc32db4d19bd3271c504f64740&quot;,&quot;4459799a34cb4a42a698b644445554b0&quot;,&quot;41912f1c03cd42cba70e32746ed83e9e&quot;,&quot;96cd2c95884c4ae08ebe0063b9d96d3a&quot;,&quot;8673cac657624bdb8a951b1b914c304e&quot;]}"
id="tLN2ittXN42-" data-outputId="6b865bbc-f893-4af5-83d9-49a9d6e47624">
<div class="sourceCode" id="cb111"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================== COTIZADOR CON WIDGETS  =====================</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, clear_output</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets <span class="im">as</span> w</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># --- helpers para opciones y rangos ---</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> qminmax(s, qlo<span class="op">=</span><span class="fl">0.01</span>, qhi<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> pd.to_numeric(s, errors<span class="op">=</span><span class="st">&quot;coerce&quot;</span>).dropna()</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> s.empty:</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span>, <span class="fl">1.0</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    lo, hi <span class="op">=</span> <span class="bu">float</span>(s.quantile(qlo)), <span class="bu">float</span>(s.quantile(qhi))</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> np.isfinite(lo) <span class="kw">or</span> <span class="kw">not</span> np.isfinite(hi) <span class="kw">or</span> lo <span class="op">&gt;=</span> hi:</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        lo, hi <span class="op">=</span> <span class="bu">float</span>(s.<span class="bu">min</span>()), <span class="bu">float</span>(s.<span class="bu">max</span>())</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lo, hi</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> options_from(col):</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> (body_train[col].dropna().astype(<span class="bu">str</span>).value_counts().index.tolist())[:<span class="dv">50</span>]</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vals <span class="cf">if</span> vals <span class="cf">else</span> [<span class="st">&quot;&quot;</span>]</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a><span class="co"># --- widgets seg√∫n tus columnas ---</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>mvr_lo, mvr_hi <span class="op">=</span> qminmax(body_train[<span class="st">&quot;MVR_PTS&quot;</span>])</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>old_lo, old_hi <span class="op">=</span> qminmax(body_train[<span class="st">&quot;OLDCLAIM&quot;</span>])</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>age_lo, age_hi <span class="op">=</span> qminmax(body_train[<span class="st">&quot;AGE&quot;</span>])</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>clm_lo, clm_hi <span class="op">=</span> qminmax(body_train[<span class="st">&quot;CLM_FREQ&quot;</span>])</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>w_mvr     <span class="op">=</span> w.IntSlider(description<span class="op">=</span><span class="st">&quot;MVR_PTS&quot;</span>, <span class="bu">min</span><span class="op">=</span><span class="bu">int</span>(mvr_lo), <span class="bu">max</span><span class="op">=</span><span class="bu">int</span>(<span class="bu">max</span>(mvr_hi, mvr_lo<span class="op">+</span><span class="dv">1</span>)), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">3</span>, continuous_update<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>w_clm     <span class="op">=</span> w.IntSlider(description<span class="op">=</span><span class="st">&quot;CLM_FREQ&quot;</span>, <span class="bu">min</span><span class="op">=</span><span class="bu">int</span>(clm_lo), <span class="bu">max</span><span class="op">=</span><span class="bu">int</span>(<span class="bu">max</span>(clm_hi, clm_lo<span class="op">+</span><span class="dv">1</span>)), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">0</span>, continuous_update<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>w_occ     <span class="op">=</span> w.Dropdown(description<span class="op">=</span><span class="st">&quot;OCCUPATION&quot;</span>, options<span class="op">=</span>options_from(<span class="st">&quot;OCCUPATION&quot;</span>), value<span class="op">=</span><span class="st">&quot;Blue Collar&quot;</span> <span class="cf">if</span> <span class="st">&quot;Blue Collar&quot;</span> <span class="kw">in</span> options_from(<span class="st">&quot;OCCUPATION&quot;</span>) <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>w_edu     <span class="op">=</span> w.Dropdown(description<span class="op">=</span><span class="st">&quot;EDUCATION&quot;</span>,  options<span class="op">=</span>options_from(<span class="st">&quot;EDUCATION&quot;</span>),  value<span class="op">=</span><span class="st">&quot;PhD&quot;</span> <span class="cf">if</span> <span class="st">&quot;PhD&quot;</span> <span class="kw">in</span> options_from(<span class="st">&quot;EDUCATION&quot;</span>) <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>w_parent1 <span class="op">=</span> w.Dropdown(description<span class="op">=</span><span class="st">&quot;PARENT1&quot;</span>,    options<span class="op">=</span>options_from(<span class="st">&quot;PARENT1&quot;</span>))</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>w_rev     <span class="op">=</span> w.Dropdown(description<span class="op">=</span><span class="st">&quot;REVOKED&quot;</span>,    options<span class="op">=</span>options_from(<span class="st">&quot;REVOKED&quot;</span>))</span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>w_mstat   <span class="op">=</span> w.Dropdown(description<span class="op">=</span><span class="st">&quot;MSTATUS&quot;</span>,    options<span class="op">=</span>options_from(<span class="st">&quot;MSTATUS&quot;</span>))</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>w_old     <span class="op">=</span> w.FloatSlider(description<span class="op">=</span><span class="st">&quot;OLDCLAIM&quot;</span>, <span class="bu">min</span><span class="op">=</span><span class="bu">float</span>(old_lo), <span class="bu">max</span><span class="op">=</span><span class="bu">float</span>(old_hi), step<span class="op">=</span>(old_hi<span class="op">-</span>old_lo)<span class="op">/</span><span class="dv">100</span> <span class="cf">if</span> old_hi<span class="op">&gt;</span>old_lo <span class="cf">else</span> <span class="fl">1.0</span>, value<span class="op">=</span><span class="fl">0.0</span>, readout_format<span class="op">=</span><span class="st">&quot;.2f&quot;</span>, continuous_update<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>w_home    <span class="op">=</span> w.IntSlider(description<span class="op">=</span><span class="st">&quot;HOMEKIDS&quot;</span>, <span class="bu">min</span><span class="op">=</span><span class="dv">0</span>, <span class="bu">max</span><span class="op">=</span><span class="bu">int</span>(<span class="bu">max</span>(<span class="dv">5</span>, body_train[<span class="st">&quot;HOMEKIDS&quot;</span>].<span class="bu">max</span>() <span class="cf">if</span> <span class="st">&quot;HOMEKIDS&quot;</span> <span class="kw">in</span> body_train <span class="cf">else</span> <span class="dv">5</span>)), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">0</span>, continuous_update<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>w_use     <span class="op">=</span> w.Dropdown(description<span class="op">=</span><span class="st">&quot;CAR_USE&quot;</span>,    options<span class="op">=</span>options_from(<span class="st">&quot;CAR_USE&quot;</span>), value<span class="op">=</span><span class="st">&quot;Private&quot;</span> <span class="cf">if</span> <span class="st">&quot;Private&quot;</span> <span class="kw">in</span> options_from(<span class="st">&quot;CAR_USE&quot;</span>) <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>w_age     <span class="op">=</span> w.IntSlider(description<span class="op">=</span><span class="st">&quot;AGE&quot;</span>,       <span class="bu">min</span><span class="op">=</span><span class="bu">int</span>(<span class="bu">max</span>(<span class="dv">16</span>, age_lo)), <span class="bu">max</span><span class="op">=</span><span class="bu">int</span>(<span class="bu">min</span>(<span class="dv">95</span>, age_hi)), step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">35</span>, continuous_update<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>btn <span class="op">=</span> w.Button(description<span class="op">=</span><span class="st">&quot;Calcular cotizaci√≥n&quot;</span>, button_style<span class="op">=</span><span class="st">&quot;primary&quot;</span>)</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> w.Output()</span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a><span class="co"># --- funci√≥n que usa tus modelos y encoder directamente ---</span></span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calcular(_):</span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> out:</span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>        clear_output()</span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>        nuevo_asegurado <span class="op">=</span> pd.DataFrame([{</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MVR_PTS&quot;</span>:   <span class="bu">int</span>(w_mvr.value),</span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CLM_FREQ&quot;</span>:  <span class="bu">int</span>(w_clm.value),</span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;OCCUPATION&quot;</span>:<span class="bu">str</span>(w_occ.value),</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;EDUCATION&quot;</span>: <span class="bu">str</span>(w_edu.value),</span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;PARENT1&quot;</span>:   <span class="bu">str</span>(w_parent1.value),</span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;REVOKED&quot;</span>:   <span class="bu">str</span>(w_rev.value),</span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MSTATUS&quot;</span>:   <span class="bu">str</span>(w_mstat.value),</span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;OLDCLAIM&quot;</span>:  <span class="bu">float</span>(w_old.value),</span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HOMEKIDS&quot;</span>:  <span class="bu">int</span>(w_home.value),</span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CAR_USE&quot;</span>:   <span class="bu">str</span>(w_use.value),</span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AGE&quot;</span>:       <span class="bu">float</span>(w_age.value),</span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;FREQUENCY&quot;</span>: <span class="dv">0</span>,</span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;SEVERITY&quot;</span>:  <span class="fl">0.0</span></span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a>        }])</span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === preparar input igual que en tu entrenamiento ===</span></span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a>        cols_modelo <span class="op">=</span> <span class="bu">list</span>(num_cols_body) <span class="op">+</span> <span class="bu">list</span>(cat_cols_body)</span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a>        X_nuevo <span class="op">=</span> nuevo_asegurado[cols_modelo].copy()</span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>        Xn_num <span class="op">=</span> X_nuevo[num_cols_body].copy()</span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>        Xn_cat <span class="op">=</span> X_nuevo[cat_cols_body].copy()</span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a>        Xn_cat_enc <span class="op">=</span> enc_body.transform(Xn_cat)</span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a>        X_nuevo_enc <span class="op">=</span> pd.concat([Xn_num.reset_index(drop<span class="op">=</span><span class="va">True</span>), Xn_cat_enc.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === predicciones ===</span></span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a>        freq_pred <span class="op">=</span> <span class="bu">float</span>(model_freq.predict(X_nuevo_enc)[<span class="dv">0</span>])</span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a>        bt_num <span class="op">=</span> body_train[num_cols_body].copy()</span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a>        bt_cat <span class="op">=</span> body_train[cat_cols_body].copy()</span>
<span id="cb111-74"><a href="#cb111-74" aria-hidden="true" tabindex="-1"></a>        bt_cat_enc <span class="op">=</span> enc_body.transform(bt_cat)</span>
<span id="cb111-75"><a href="#cb111-75" aria-hidden="true" tabindex="-1"></a>        Xtr_enc_body <span class="op">=</span> pd.concat([bt_num.reset_index(drop<span class="op">=</span><span class="va">True</span>), bt_cat_enc.reset_index(drop<span class="op">=</span><span class="va">True</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb111-76"><a href="#cb111-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-77"><a href="#cb111-77" aria-hidden="true" tabindex="-1"></a>        ytr_log_true <span class="op">=</span> np.log(body_train[<span class="st">&quot;SEVERITY&quot;</span>].clip(lower<span class="op">=</span><span class="fl">1e-6</span>))</span>
<span id="cb111-78"><a href="#cb111-78" aria-hidden="true" tabindex="-1"></a>        res_log <span class="op">=</span> ytr_log_true.values <span class="op">-</span> model_body.predict(Xtr_enc_body)</span>
<span id="cb111-79"><a href="#cb111-79" aria-hidden="true" tabindex="-1"></a>        sigma2 <span class="op">=</span> <span class="bu">float</span>(np.mean(res_log<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb111-80"><a href="#cb111-80" aria-hidden="true" tabindex="-1"></a>        corr <span class="op">=</span> <span class="bu">float</span>(np.exp(<span class="fl">0.5</span> <span class="op">*</span> sigma2))</span>
<span id="cb111-81"><a href="#cb111-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-82"><a href="#cb111-82" aria-hidden="true" tabindex="-1"></a>        sev_pred_log <span class="op">=</span> <span class="bu">float</span>(model_body.predict(X_nuevo_enc)[<span class="dv">0</span>])</span>
<span id="cb111-83"><a href="#cb111-83" aria-hidden="true" tabindex="-1"></a>        sev_pred <span class="op">=</span> <span class="bu">float</span>(np.exp(sev_pred_log) <span class="op">*</span> corr)</span>
<span id="cb111-84"><a href="#cb111-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb111-85"><a href="#cb111-85" aria-hidden="true" tabindex="-1"></a>            sev_pred <span class="op">=</span> <span class="bu">float</span>(np.minimum(sev_pred, u))</span>
<span id="cb111-86"><a href="#cb111-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">NameError</span>:</span>
<span id="cb111-87"><a href="#cb111-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb111-88"><a href="#cb111-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-89"><a href="#cb111-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># === primas (usa tu loading definido antes) ===</span></span>
<span id="cb111-90"><a href="#cb111-90" aria-hidden="true" tabindex="-1"></a>        prima_pura <span class="op">=</span> freq_pred <span class="op">*</span> sev_pred</span>
<span id="cb111-91"><a href="#cb111-91" aria-hidden="true" tabindex="-1"></a>        prima_con_loading <span class="op">=</span> prima_pura <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> loading)</span>
<span id="cb111-92"><a href="#cb111-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-93"><a href="#cb111-93" aria-hidden="true" tabindex="-1"></a>        cotizacion <span class="op">=</span> nuevo_asegurado.copy()</span>
<span id="cb111-94"><a href="#cb111-94" aria-hidden="true" tabindex="-1"></a>        cotizacion[<span class="st">&quot;freq_esperada&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(freq_pred, <span class="dv">5</span>)</span>
<span id="cb111-95"><a href="#cb111-95" aria-hidden="true" tabindex="-1"></a>        cotizacion[<span class="st">&quot;sev_esperada&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(sev_pred, <span class="dv">2</span>)</span>
<span id="cb111-96"><a href="#cb111-96" aria-hidden="true" tabindex="-1"></a>        cotizacion[<span class="st">&quot;prima_pura&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(prima_pura, <span class="dv">2</span>)</span>
<span id="cb111-97"><a href="#cb111-97" aria-hidden="true" tabindex="-1"></a>        cotizacion[<span class="st">&quot;prima_con_loading&quot;</span>] <span class="op">=</span> <span class="bu">round</span>(prima_con_loading, <span class="dv">2</span>)</span>
<span id="cb111-98"><a href="#cb111-98" aria-hidden="true" tabindex="-1"></a>        col_map <span class="op">=</span> {</span>
<span id="cb111-99"><a href="#cb111-99" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MVR_PTS&quot;</span>: <span class="st">&quot;Puntuaci√≥n del conductor&quot;</span>,</span>
<span id="cb111-100"><a href="#cb111-100" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CLM_FREQ&quot;</span>: <span class="st">&quot;# Siniestros (√∫ltimos 5 a√±os)&quot;</span>,</span>
<span id="cb111-101"><a href="#cb111-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;OCCUPATION&quot;</span>: <span class="st">&quot;Profesi√≥n&quot;</span>,</span>
<span id="cb111-102"><a href="#cb111-102" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;EDUCATION&quot;</span>: <span class="st">&quot;Nivel educativo&quot;</span>,</span>
<span id="cb111-103"><a href="#cb111-103" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;PARENT1&quot;</span>: <span class="st">&quot;Tiene hijos&quot;</span>,</span>
<span id="cb111-104"><a href="#cb111-104" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;REVOKED&quot;</span>: <span class="st">&quot;Licencia suspendida&quot;</span>,</span>
<span id="cb111-105"><a href="#cb111-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MSTATUS&quot;</span>: <span class="st">&quot;Estado civil&quot;</span>,</span>
<span id="cb111-106"><a href="#cb111-106" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;OLDCLAIM&quot;</span>: <span class="st">&quot;Monto siniestros previos&quot;</span>,</span>
<span id="cb111-107"><a href="#cb111-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HOMEKIDS&quot;</span>: <span class="st">&quot;Cantidad de hijos&quot;</span>,</span>
<span id="cb111-108"><a href="#cb111-108" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CAR_USE&quot;</span>: <span class="st">&quot;Uso del veh√≠culo&quot;</span>,</span>
<span id="cb111-109"><a href="#cb111-109" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AGE&quot;</span>: <span class="st">&quot;Edad&quot;</span></span>
<span id="cb111-110"><a href="#cb111-110" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb111-111"><a href="#cb111-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-112"><a href="#cb111-112" aria-hidden="true" tabindex="-1"></a>        cols_es <span class="op">=</span> [</span>
<span id="cb111-113"><a href="#cb111-113" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Puntuaci√≥n del conductor&quot;</span>,<span class="st">&quot;Profesi√≥n&quot;</span>,<span class="st">&quot;Nivel educativo&quot;</span>,<span class="st">&quot;Edad&quot;</span>,<span class="st">&quot;Uso del veh√≠culo&quot;</span>,</span>
<span id="cb111-114"><a href="#cb111-114" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;freq_esperada&quot;</span>,<span class="st">&quot;sev_esperada&quot;</span>,<span class="st">&quot;prima_pura&quot;</span>,<span class="st">&quot;prima_con_loading&quot;</span></span>
<span id="cb111-115"><a href="#cb111-115" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb111-116"><a href="#cb111-116" aria-hidden="true" tabindex="-1"></a>        cotizacion_view <span class="op">=</span> cotizacion.rename(columns<span class="op">=</span>col_map)</span>
<span id="cb111-117"><a href="#cb111-117" aria-hidden="true" tabindex="-1"></a>        display(cotizacion_view[cols_es])</span>
<span id="cb111-118"><a href="#cb111-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-119"><a href="#cb111-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-120"><a href="#cb111-120" aria-hidden="true" tabindex="-1"></a>btn.on_click(calcular)</span>
<span id="cb111-121"><a href="#cb111-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-122"><a href="#cb111-122" aria-hidden="true" tabindex="-1"></a><span class="co"># --- mostrar interfaz ---</span></span>
<span id="cb111-123"><a href="#cb111-123" aria-hidden="true" tabindex="-1"></a>ui_left  <span class="op">=</span> w.VBox([w_mvr, w_clm, w_old, w_home, w_age])</span>
<span id="cb111-124"><a href="#cb111-124" aria-hidden="true" tabindex="-1"></a>ui_right <span class="op">=</span> w.VBox([w_occ, w_edu, w_parent1, w_rev, w_mstat, w_use])</span>
<span id="cb111-125"><a href="#cb111-125" aria-hidden="true" tabindex="-1"></a>display(w.HBox([ui_left, w.Label(<span class="st">&quot;   &quot;</span>), ui_right]))</span>
<span id="cb111-126"><a href="#cb111-126" aria-hidden="true" tabindex="-1"></a>display(btn, out)</span>
<span id="cb111-127"><a href="#cb111-127" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================== FIN COTIZADOR CON WIDGETS =====================</span></span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb112"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;a372091bc81f47a7a1c49b32c622c8c1&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb113"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;fb0b9bcc32db4d19bd3271c504f64740&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb114"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;96cd2c95884c4ae08ebe0063b9d96d3a&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
</body>
</html>
